# DBProject5785_4618_7706

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×  
- [×©×œ×‘ 1: ×ª×›× ×•×Ÿ ×•×‘× ×™×™×ª ××¡×“ ×”× ×ª×•× ×™×](#×©×œ×‘-1-×ª×›× ×•×Ÿ-×•×‘× ×™×™×ª-××¡×“-×”× ×ª×•× ×™×)  
  - [××‘×•×](#××‘×•×)  
  - [ERD (×ª×¨×©×™× ×™×©×•×™×•×ª-×§×©×¨×™×)](#erd-×ª×¨×©×™×-×™×©×•×™×•×ª-×§×©×¨×™×)  
  - [DSD (×ª×¨×©×™× ××‘× ×” × ×ª×•× ×™×)](#dsd-×ª×¨×©×™×-××‘× ×”-× ×ª×•× ×™×)  
  - [×¡×§×¨×™×¤×˜×™× ×‘-SQL](#×¡×§×¨×™×¤×˜×™×-×‘-sql)  
  - [× ×ª×•× ×™×](#× ×ª×•× ×™×)  
  - [×’×™×‘×•×™](#×’×™×‘×•×™)  
- [×©×œ×‘ 2: ×©××™×œ×ª×•×ª ×•××™×œ×•×¦×™×](#×©×œ×‘-2-×©××™×œ×ª×•×ª-×•××™×œ×•×¦×™×)
  - [×©××™×œ×ª×•×ª SELECT](#×©××™×œ×ª×•×ª-SELECT)
  - [×©××™×œ×ª×•×ª DELETE](#×©××™×œ×ª×•×ª-DELETE)
  - [×©××™×œ×ª×•×ª UPDATE](#×©××™×œ×ª×•×ª-UPDATE)
  - [××™×œ×•×¦×™×](#××™×œ×•×¦×™×)
  - [×‘×™×¦×•×¢ Rollback ×•Commit ](#×‘×™×¦×•×¢-rollbac-×•-commit )
  - [×’×™×‘×•×™ ××¢×•×“×›×Ÿ](#×’×™×‘×•×™-××¢×•×“×›×Ÿ)
- [×©×œ×‘ 3: ××™× ×˜×’×¨×¦×™×” ×•××‘×˜×™×](#×©×œ×‘-3-××™× ×˜×’×¨×¦×™×”-×•××‘×˜×™×)
  - [××‘×•×](#××‘×•×2)
  - [×ª×¨×©×™× DSD ×©×œ ×”××¢×¨×›×ª ×”×—×“×©×”](#×ª×¨×©×™×-DSD-×©×œ-×”××¢×¨×›×ª-×”×—×“×©×”)
  - [×ª×”×œ×™×š ×”× ×“×¡×” ×”×¤×•×›×” (Reverse Engineering)](#×ª×”×œ×™×š-×”× ×“×¡×”-×”×¤×•×›×”) 
  - [×ª×¨×©×™× ERD ×©×œ ×”××¢×¨×›×ª ×”×—×“×©×”](#×ª×¨×©×™×-ERD-×©×œ-×”××¢×¨×›×ª-×”×—×“×©×”)
  - [× ×™×ª×•×— ×•×”×©×•×•××ª ×”××¢×¨×›×•×ª](#× ×™×ª×•×—-×•×”×©×•×•××ª-×”××¢×¨×›×•×ª)
  - [×ª×”×œ×™×š ×”××™× ×˜×’×¨×¦×™×”](#×ª×”×œ×™×š-×”××™× ×˜×’×¨×¦×™×”)
  - [×ª×¨×©×™× ERD ××©×•×œ×‘](#×ª×¨×©×™×-ERD-××©×•×œ×‘)
  - [×”×—×œ×˜×•×ª ××™× ×˜×’×¨×¦×™×”](#×”×—×œ×˜×•×ª-××™× ×˜×’×¨×¦×™×”)
  - [×ª×”×œ×™×š ××™×¤×•×™ ×”× ×ª×•× ×™×](#×ª×”×œ×™×š-××™×¤×•×™-×”× ×ª×•× ×™×)
  - [×”×¡×‘×¨ ×”×¤×§×•×“×•×ª SQL](#×”×¡×‘×¨-×”×¤×§×•×“×•×ª-sql)
  - [××ª×’×¨×™× ×•×¤×ª×¨×•× ×•×ª](#××ª×’×¨×™×-×•×¤×ª×¨×•× ×•×ª)
  - [××¡×§× ×•×ª](#××¡×§× ×•×ª)
  - [××‘×˜×™×](#××‘×˜×™×)
  - [×’×™×‘×•×™ ××¢×•×“×›×Ÿ](#×’×™×‘×•×™-××¢×•×“×›×Ÿ2)
- [×©×œ×‘ 4: ×ª×›× ×•×ª PL/pgSQL](#×©×œ×‘-4:-×ª×›× ×•×ª-PL/pgSQL)
  - [×¤×•× ×§×¦×™×•×ª](#×¤×•× ×§×¦×™×•×ª)
  - [×¤×¨×•×¦×“×•×¨×•×ª](#×¤×¨×•×¦×“×•×¨×•×ª)
  - [×˜×¨×™×’×¨×™×](#×˜×¨×™×’×¨×™×)
  - [×ª×•×›× ×™×•×ª ×¨××©×™×•×ª](#×ª×•×›× ×™×•×ª-×¨××©×™×•×ª)

## ×©×œ×‘ 1: ×ª×›× ×•×Ÿ ×•×‘× ×™×™×ª ××¡×“ ×”× ×ª×•× ×™×  

### ××‘×•×

# ××¢×¨×›×ª × ×™×”×•×œ ××›×•×Ÿ ×›×•×©×¨

## ×ª×™××•×¨ ×”×¤×¨×•×™×§×˜

××¢×¨×›×ª × ×™×”×•×œ ××›×•×Ÿ ×”×›×•×©×¨ × ×•×¢×“×” ×œ×™×™×¢×œ ××ª ×ª×”×œ×™×š ×”××¨×’×•×Ÿ ×•×”××¢×§×‘ ××—×¨ ××™×“×¢ ×—×™×•× ×™ ×”×§×©×•×¨ ×œ×× ×•×™×™×, ××“×¨×™×›×™×, ×¡×•×’×™ ×©×™×¢×•×¨×™×, ×¦×™×•×“ ×•×—×“×¨×™×. ××¢×¨×›×ª ×–×• ×××¤×©×¨×ª ×œ×× ×”×œ×™ ××›×•×Ÿ ×”×›×•×©×¨, ×œ××“×¨×™×›×™× ×•×œ×× ×•×™×™× ×’×™×©×” × ×•×—×” ×œ××™×“×¢ ××¢×•×“×›×Ÿ, ×ª×•×š ×©××™×¨×” ×¢×œ ××‘× ×” × ×ª×•× ×™× ×™×¢×™×œ ×•××¡×•×“×¨.

## ××˜×¨×ª ×”××¢×¨×›×ª

××¡×“ × ×ª×•× ×™× ×–×” ××©××© ×›×¤×ª×¨×•×Ÿ ××•×‘× ×” ×•×××™×Ÿ ×œ××›×•× ×™ ×›×•×©×¨ ×¢×œ ×× ×ª:

- ×œ× ×”×œ ×¨×©×™××ª ×× ×•×™×™×, ×›×•×œ×œ ×ª××¨×™×›×™ ×¨×™×©×•× ×•×ª×•×§×£ ×”×× ×•×™.
- ×œ×§×©×¨ ××“×¨×™×›×™× ××•×¡××›×™× ×œ×¡×•×’×™ ×©×™×¢×•×¨×™× ×©×•× ×™× ×‘×”×ª×× ×œ×¨××ª ×”× ×™×¡×™×•×Ÿ ×”× ×“×¨×©×ª.
- ×œ××¨×’×Ÿ ×©×™×¢×•×¨×™× ×¢×œ ×¤×™ ×™××™× ×‘×©×‘×•×¢, ×©×¢×•×ª, ×¡×•×’×™× ×•×”×“×¨×™×©×•×ª ×”××™×•×—×“×•×ª ×œ×›×œ ×©×™×¢×•×¨.
- ×œ× ×”×œ ××ª ×”×—×“×¨×™× ×”×–××™× ×™× ×‘××›×•×Ÿ ×•×œ×”×‘×˜×™×— ×©×”×§×™×‘×•×œ×ª ××ª××™××” ×œ×©×™×¢×•×¨×™× ×”××ª×•×›× × ×™×.
- ×œ×¢×§×•×‘ ××—×¨ ×¦×™×•×“ ×”×›×•×©×¨, ×›×•×œ×œ ××¦×‘×• ×•××™×§×•××•.

## ××§×¨×™ ×©×™××•×© ×¤×•×˜× ×¦×™××œ×™×™×

- **×× ×”×œ×™ ××›×•×Ÿ ×”×›×•×©×¨** ×™×›×•×œ×™× ×œ×”×©×ª××© ×‘××¢×¨×›×ª ×œ× ×™×”×•×œ ×× ×•×™×™×, ×©×™×¢×•×¨×™×, ××“×¨×™×›×™× ×•×—×“×¨×™× ×‘××•×¤×Ÿ ×™×¢×™×œ ×•××¡×•×“×¨.
- **××“×¨×™×›×™×** ×™×›×•×œ×™× ×œ×‘×“×•×§ ××™×œ×• ×©×™×¢×•×¨×™× ×”× ××•×¡××›×™× ×œ×”×¢×‘×™×¨, ××™×œ×• ×—×“×¨×™× ×–××™× ×™× ×•×œ×”×™×¨×©× ×œ×”×¢×‘×¨×ª ×©×™×¢×•×¨×™× ×‘×”×ª×× ×œ× ×™×¡×™×•× ×.
- **×× ×•×™×™×** ×™×›×•×œ×™× ×œ×”×™×¨×©× ×œ×©×™×¢×•×¨×™× ×”×©×•× ×™× ×‘×”×ª×× ×œ××’×“×¨× ×•×œ×”×¢×“×¤×•×ª×™×”× ×•×œ×•×•×“× ×©×”×©×™×¢×•×¨×™× ××•×ª×××™× ×œ×¨××ª× ×•×œ×¦×¨×›×™×”×.
- **×¦×•×•×ª ×”××›×•×Ÿ** ×™×›×•×œ ×œ×¢×§×•×‘ ××—×¨ ××¦×‘ ×”×¦×™×•×“ ×•×œ×•×•×“× ×ª×—×–×•×§×” ×©×•×˜×¤×ª ×©×œ ×—×“×¨×™ ×”×›×•×©×¨ ×•×”××‘×™×–×¨×™×.

××¡×“ × ×ª×•× ×™× ×–×” ××¡×™×™×¢ ×œ×™×™×¢×•×œ ×”× ×™×”×•×œ, ×œ×©×™×¤×•×¨ ×”××¨×’×•×Ÿ ×•×œ×©××™×¨×” ×¢×œ ×—×•×•×™×™×ª ××™××•×Ÿ ××•×¤×˜×™××œ×™×ª ×¢×‘×•×¨ ×›×œ×œ ×”××©×ª××©×™×.


###  ERD (×ª×¨×©×™× ×™×©×•×™×•×ª-×§×©×¨×™×)    
![ERD (×ª×¨×©×™× ×™×©×•×™×•×ª-×§×©×¨×™×)](Stage1/ERDAndDSD/ERD.png)  

###  DSD  (×ª×¨×©×™× ××‘× ×” × ×ª×•× ×™×)
![DSD (×ª×¨×©×™× ××‘× ×” × ×ª×•× ×™×)](Stage1/ERDAndDSD/DSD.png)  

### ×¡×§×¨×™×¤×˜×™× ×‘-SQL  
×¡×¤×§ ××ª ×¡×§×¨×™×¤×˜×™ ×”-SQL ×”×‘××™×:  
- **×¡×§×¨×™×¤×˜ ×™×¦×™×¨×ª ×˜×‘×œ××•×ª** - ×”×¡×§×¨×™×¤×˜ ×œ×™×¦×™×¨×ª ×˜×‘×œ××•×ª ××¡×“ ×”× ×ª×•× ×™× ×–××™×Ÿ ×‘×××’×¨:  

ğŸ“œ **[×¦×¤×™×™×” ×‘-create_tables.sql](Stage1/scripts/createTable.sql)**  

- **×¡×§×¨×™×¤×˜ ×”×•×¡×¤×ª × ×ª×•× ×™×** - ×”×¡×§×¨×™×¤×˜ ×œ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ××•×ª ××¡×“ 


×”× ×ª×•× ×™× ×–××™×Ÿ ×‘×××’×¨:  

ğŸ“œ **[×¦×¤×™×™×” ×‘-insert_tables.sql](Stage1/scripts/insertTables.sql)**  

- **×¡×§×¨×™×¤×˜ ××—×™×§×ª ×˜×‘×œ××•×ª** - ×”×¡×§×¨×™×¤×˜ ×œ××—×™×§×ª ×›×œ ×”×˜×‘×œ××•×ª ×–××™×Ÿ ×‘×××’×¨:  

ğŸ“œ **[×¦×¤×™×™×” ×‘-drop_tables.sql](Stage1/scripts/dropTables.sql)**  

- **×¡×§×¨×™×¤×˜ ×©×œ×™×¤×ª ×›×œ ×”× ×ª×•× ×™×** - ×”×¡×§×¨×™×¤×˜ ×œ×©×œ×™×¤×ª ×›×œ ×”× ×ª×•× ×™× ××›×œ ×”×˜×‘×œ××•×ª ×–××™×Ÿ ×‘×××’×¨:  

ğŸ“œ **[×¦×¤×™×™×” ×‘-selectAll_tables.sql](Stage1/scripts/selectAll.sql)**

### × ×ª×•× ×™×  
#### ×›×œ×™ ×¨××©×•×Ÿ: ×©×™××•×© ×‘-[Mockaroo](https://www.mockaroo.com/) ×œ×™×¦×™×¨×ª ×§×•×‘×¥ CSV  
##### ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª person  
- ×˜×•×•×— ××–×”×™ person: 1-800  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Person.csv`](Stage1/mockData/Person.csv)  

##### ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Member  
- ×˜×•×•×— ××–×”×™ person: 1-400  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Member.csv`](Stage1/mockData/Member.csv)  
 
##### ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Trainer
- ×˜×•×•×— ××–×”×™ person: 401-800  
- × ×•×¡×—×ª ××–×”×” ××™×©: `this + 400`  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Trainer.csv`](Stage1/mockData/Trainer.csv)  


### ×“×•×’××” ×œ×”××—×©×ª ×”×¢×‘×•×“×” ×‘××ª×¨ ×¢×‘×•×¨ ×”×˜×‘×œ×” Person: 
- ×”×’×“×¨×ª ×¡×•×’×™ ×ª×›×•× ×•×ª ×”×™×©×•×ª ×•×©××•×ª×™×”× ×‘××ª×¨
![image](Stage1/mockData/1.jpeg)
- ×”×¢×œ××ª ×”×§×•×‘×¥ ×©× ×•×¦×¨ ×œ×××’×¨ ×¢"×™ ×¢××™×“×” ×¢×œ ×”×˜×‘×œ×” ×©×œ Person, ×œ×—×™×¦×” ×™×× ×™×ª ×•- Import->Export Data
![image](Stage1/mockData/2.jpeg)
 - ×ª×•×¦××ª ×”×©××™×œ×ª× `;SELECT * FROM Person`:
![image](Stage1/mockData/3.jpeg)
   

### ×›×œ×™ ×©× ×™: ×©×™××•×© ×‘-[generatedata](https://generatedata.com/generator) ×œ×™×¦×™×¨×ª ×§×•×‘×¥ CSV  
##### ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Room  
- ×˜×•×•×— ××¡×¤×¨×™ ×§×‘×•×¦×”: 1-400  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Room.csv`](Stage1/genData/Room.csv)
##### ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Class  
- ×˜×•×•×— ××¡×¤×¨×™ ×§×‘×•×¦×”: 1-400  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Class.csv`](Stage1/genData/Class.csv)
##### ×”×–× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª ClassType  
- ×˜×•×•×— ××¡×¤×¨×™ ×§×‘×•×¦×”: 1-400  
ğŸ“œ [×¦×¤×™×™×” ×‘-`ClassType.csv`](Stage1/genData/ClassType.csv)  

### ×“×•×’××” ×œ×”××—×©×ª ×”×¢×‘×•×“×” ×‘××ª×¨ ×¢×‘×•×¨ ×”×˜×‘×œ×” ClassType: 
- ×”×’×“×¨×ª ×¡×•×’×™ ×ª×›×•× ×•×ª ×”×™×©×•×ª ×•×©××•×ª×™×”× ×‘××ª×¨

![image](Stage1/genData/1.jpeg)

- ×¢×¨×™×›×ª ×”×”×’×“×¨×•×ª ×œ×”×•×¦××ª ×§×•×‘×¥ ×‘×¤×•×¨××˜ CSV


![image](Stage1/genData/2.jpeg)

![image](Stage1/genData/3.jpeg)


- ×™×¦×™×¨×ª 400 ×¨×©×•××•×ª ×œ×˜×‘×œ×” ×•×œ×—×™×¦×” ×¢×œ Generate
  
![image](Stage1/genData/4.jpeg)


- ×”×¢×œ××ª ×”×§×•×‘×¥ ×”× ×•×¦×¨ ×œ×××’×¨ ×•×§×‘×œ×ª ×”××™×©×•×¨ ×œ×”×œ×Ÿ

![image](Stage1/genData/5.jpeg)

 - ×ª×•×¦××ª ×”×©××™×œ×ª×” `;SELECT 'ClassType' AS table_name, COUNT(*) FROM ClassType`:

![image](Stage1/genData/6.jpeg)


#### ×›×œ×™ ×©×œ×™×©×™: ×©×™××•×© ×‘-Python ×œ×™×¦×™×¨×ª ×§×‘×¦×™ CSV
##### ×™×¦×™×¨×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Equipment
- ×˜×•×•×— ××¡×¤×¨×™ ×§×‘×•×¦×”: 1-400  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Equipment.csv`](Stage1/pythonData/Equipment.csv)
##### ×™×¦×™×¨×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Certified_For  
- ×©× ×™ ××¤×—×ª×•×ª ×–×¨×™× ×¢"×¤ ×˜×•×•×—×™×”×
ğŸ“œ [×¦×¤×™×™×” ×‘-`Certified_For.csv`](Stage1/pythonData/Certified_For.csv)
##### ×™×¦×™×¨×ª × ×ª×•× ×™× ×œ×˜×‘×œ×ª Registers_For  
- ×©× ×™ ××¤×ª×—×•×ª ×–×¨×™× ×¢"×¤ ×˜×•×•×—×™×”×  
ğŸ“œ [×¦×¤×™×™×” ×‘-`Registers_For.csv`](Stage1/pythonData/Registers_For.csv)

##### ×¡×§×¨×™×¤×˜ ×”×™×¦×™×¨×”: [×¦×¤×™×™×” ×‘-`genCSV.py`](Stage1/pythonData/genCSV.py)
- 3 ×§×‘×¦×™ ×”CSV ×©×”×¡×§×¨×™×¤×˜ ×™×¦×¨ ×”×•×¢×œ××• ×‘×”×¦×œ×—×” ×œ×××’×¨

![image](Stage1/pythonData/1.jpeg)

![image](Stage1/pythonData/2.jpeg)

![image](Stage1/pythonData/3.jpeg)


### ×’×™×‘×•×™  
- ×§×‘×¦×™ ×”×’×™×‘×•×™ × ×©××¨×™× ×¢× ×”×ª××¨×™×š ×•×”×©×¢×” ×©×œ ××•×¢×“ ×”×’×™×‘×•×™:
  
ğŸ“œ [×¦×¤×™×™×” ×‘×ª×™×§×™×™×ª ×”×’×™×‘×•×™×™×-`Backups`](Stage1)

- ×”×¦×“ ×”××’×‘×”: ×¢×•××“ ×¢×œ ×”×××’×¨, ×œ×—×™×¦×” ×™×× ×™×ª ×•×‘×•×—×¨ ××ª ×”××¤×©×¨×•×ª ×©×œ Backup.
- ×™×© ×œ×‘×—×•×¨ ×‘×¤×•×¨××˜ Tar ×•×œ×§×¨× ×œ×§×•×‘×¥ ×‘×©× backup_dd_mm_yy_hh_mi ×œ××¢×Ÿ ×”×¡×“×¨ ×”×˜×•×‘.
 


![1](https://github.com/user-attachments/assets/5319fd11-2a44-436d-9854-ab3b31784da2)


- ×”×¦×“ ×”××©×—×–×¨: ×“×•××’ ×©×§×•×‘×¥ ×”×’×™×‘×•×™ ×©× ×•×¦×¨ ×™×”×™×” × ××¦× ××¦×œ×• ×‘Storage Manager, ×¢×•××“ ×¢×œ ×”×××’×¨, ×œ×—×™×¦×” ×™×× ×™×ª ×•×‘×•×—×¨ ××ª ×”××¤×©×¨×•×ª ×©×œ Restore
- ×•×‘×•×—×¨ ××ª ×§×•×‘×¥ ×”×’×™×‘×•×™ ×”××“×•×‘×¨
  
![2](https://github.com/user-attachments/assets/b0399c59-ba81-4cc5-8699-3ca952d856ef)


## ×©×œ×‘ 2: ××™× ×˜×’×¨×¦×™×” ×•×©××™×œ×ª×•×ª
### ×©××™×œ×ª×•×ª SELECT
ğŸ“œ [×¦×¤×™×™×” ×‘×§×•×‘×¥ ×›×œ ×”×©××™×œ×ª×•×ª-`Queries.sql`](Stage2)

#### ×©××™×œ×ª×” 1
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××—×–×™×¨×” ××ª ×›×œ ×”××“×¨×™×›×™× (trainers) ×©×”× ×’×‘×¨×™×. ×”×™× ××¦×™×’×” ××ª ×ª×¢×•×“×ª ×”×–×”×•×ª ×©×œ×”×, ×©×, ×’×™×œ ×•×¨××ª × ×™×¡×™×•×Ÿ. ×”×ª×•×¦××” ×××•×™×™× ×ª ×œ×¤×™ ×¨××ª ×”× ×™×¡×™×•×Ÿ ×‘×¡×“×¨ ×¢×•×œ×” ×•××™×•×Ÿ ××©× ×™ ×œ×¤×™ ×©× ×‘×¡×“×¨ ××œ×¤×‘×™×ª×™.

**×”×©××™×œ×ª×” ×¨×¦×” ×‘×”×¦×œ×—×”:**

![WhatsApp Image 2025-04-28 at 02 44 08](https://github.com/user-attachments/assets/5f5dec79-6b7e-4a87-ab93-dc5307512d2a)


**×¦×™×œ×•× ×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 02 44 42](https://github.com/user-attachments/assets/a6b5ab5e-ce04-47fe-9ec8-ded0c93f2ae5)

---

#### ×©××™×œ×ª×” 2
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××—×–×™×¨×” ××ª ××¡×¤×¨ ×”×©×™×¢×•×¨×™× ×©×›×œ ××“×¨×™×š ××œ××“, ×™×—×“ ×¢× ×©××•. ×”×ª×•×¦××•×ª ×××•×™×™× ×•×ª ×œ×¤×™ ×›××•×ª ×”×©×™×¢×•×¨×™× ×‘×¡×“×¨ ×™×•×¨×“.

**×”×©××™×œ×ª×” ×¨×¦×” ×‘×”×¦×œ×—×”:**

![WhatsApp Image 2025-04-28 at 02 56 14](https://github.com/user-attachments/assets/6cd9c263-2f27-4a17-bd28-d36cddff4984)


**×¦×™×œ×•× ×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 02 56 43](https://github.com/user-attachments/assets/a1f47a12-da63-4fcb-a513-12661c1664f7)

---

#### ×©××™×œ×ª×” 3
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××¦×™×’×” ××ª ×¨×©×™××ª ×”×× ×•×™×™× ×©×”×× ×•×™ ×©×œ×”× ×™×¤×•×’ ×‘×—×•×“×© ×”×‘×, ×›×•×œ×œ ×©× ×”×× ×•×™ ×•×ª××¨×™×š ×”×ª×¤×•×’×”. ×”×ª×•×¦××•×ª ×××•×™×™× ×•×ª ×œ×¤×™ ×ª××¨×™×š ×”×ª×¤×•×’×” ×‘×¡×“×¨ ×¢×•×œ×”.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 05 32](https://github.com/user-attachments/assets/497771e1-4532-4247-a884-88f59a434849)



**×¦×™×œ×•× ×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 05 49](https://github.com/user-attachments/assets/fd4f8847-51b5-47fa-bcc9-f821ff68ff44)

---

#### ×©××™×œ×ª×” 4
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××¦×™×’×” ××ª ×¤×¨×˜×™ ×”×©×™×¢×•×¨×™× ×©××ª×§×™×™××™× ×”×™×•×: ×™×•× ×‘×©×‘×•×¢, ××–×”×” ×©×™×¢×•×¨, ×©×¢×”, ×¡×•×’ ×©×™×¢×•×¨, ××–×”×” ×”××“×¨×™×š, ×¨××ª ×”× ×™×¡×™×•×Ÿ ×©×œ ×”××“×¨×™×š ×•×©× ×”×—×“×¨.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 08 48](https://github.com/user-attachments/assets/0c8d86b4-4f1d-4578-8f0d-1a24876ed827)


**×¦×™×œ×•× ×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 09 44](https://github.com/user-attachments/assets/44323c1f-7e7a-4230-9736-f6a01dcafe18)



---

#### ×©××™×œ×ª×” 5
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××¦×™×’×” ××ª ×›×œ ×”×©×™×¢×•×¨×™× ××œ×™×”× ×× ×•×™ ×‘×¢×œ ××–×”×” 1 ×¨×©×•×, ×›×•×œ×œ ×©× ×”×× ×•×™, ××–×”×” ×”×©×™×¢×•×¨, ×¡×•×’ ×”×©×™×¢×•×¨, ×™×•× ×‘×©×‘×•×¢, ×©×¢×” ×•×©× ×”×—×“×¨.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 21 03](https://github.com/user-attachments/assets/df75567d-91bf-41c6-a963-ad6b9e3df9f3)


**×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 21 21](https://github.com/user-attachments/assets/875146a8-7145-45ba-9bfe-1887edd48031)

---

#### ×©××™×œ×ª×” 6
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××¦×™×’×” ××ª ×¤×¨×˜×™ ×”×—×“×¨×™× ×”×¤× ×•×™×™× ×”×™×•× (×—×“×¨×™× ×©×œ× ××ª×§×™×™× ×‘×”× ×©×™×¢×•×¨), ×›×•×œ×œ ××–×”×” ×”×—×“×¨, ×©× ×”×—×“×¨ ×•×ª×›×•×œ×ª ×”×—×“×¨. ×”×ª×•×¦××•×ª ×××•×™×™× ×•×ª ×œ×¤×™ ×©× ×”×—×“×¨.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 23 56](https://github.com/user-attachments/assets/1321a298-869c-406a-8944-30cefac72d54)



**×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 24 27](https://github.com/user-attachments/assets/79adb7d3-709a-4e78-b05d-5f77504f8e31)

---

#### ×©××™×œ×ª×” 7
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××¦×™×’×” ××ª ×¤×¨×˜×™ ×”×× ×•×™×™× ×©×¨×©×•××™× ×œ×©×™×¢×•×¨ ××¡×•×™×™× (××–×”×” ×©×™×¢×•×¨ 5). ××•×¦×’×™× ×ª×¢×•×“×ª ×–×”×•×ª, ×©×, ××’×“×¨ ×•×ª××¨×™×š ×œ×™×“×” ×©×œ ×›×œ ×× ×•×™.


**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 31 58](https://github.com/user-attachments/assets/ef5effa7-f2ba-41b1-9ddf-84c9d02983ed)

**×ª×•×¦××ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 32 17](https://github.com/user-attachments/assets/791caa5f-4871-4950-baa7-69ce7430d189)

---

#### ×©××™×œ×ª×” 8
**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××¦×™×’×” ××ª ×›×œ ×”×©×™×¢×•×¨×™× ×©×”×’×‘×œ×ª ×’×™×œ ×”××™× ×™××œ×™×ª ×©×œ×”× ××ª××™××” ×œ×’×™×œ 19 (×›×œ×•××¨, ×”××™× ×™××•× ×”×•× 19 ××• ×¤×—×•×ª). ××•×¦×’×™× ××–×”×” ×©×™×¢×•×¨, ×™×•× ×‘×©×‘×•×¢, ×©×¢×”, ×¡×•×’ ×©×™×¢×•×¨, ×’×™×œ ××™× ×™××œ×™ × ×“×¨×© ×•×©× ×”×—×“×¨.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-04-28 at 03 34 05](https://github.com/user-attachments/assets/0ff2f21e-5f0c-4850-bc92-bf1a6354e951)


**×ª×•×¦××ª ×”×©××™×œ×ª×”:**
![WhatsApp Image 2025-04-28 at 03 34 18](https://github.com/user-attachments/assets/5da9be7b-598a-4dd4-a5f1-a502a51b8dd7)

---

### ×©××™×œ×ª×•×ª DELETE
#### ğŸ”» ×©××™×œ×ª×” 1 â€“ ××—×™×§×ª ××“×¨×™×›×™× ×‘×¢×œ×™ × ×™×¡×™×•×Ÿ × ××•×š ×©×œ× ××¢×‘×™×¨×™× ×©×™×¢×•×¨×™×

**×ª×™××•×¨:**  
×‘×©××™×œ×ª×” ×–×• × ××—×§×™× ××“×¨×™×›×™× (Trainer) ×‘×¢×œ×™ ×¨××ª × ×™×¡×™×•×Ÿ 1, ××©×¨ ××™× × ××©×•×™×›×™× ×œ××£ ×©×™×¢×•×¨ ×‘×˜×‘×œ×” `Class`. ×›×œ×•××¨, ××“×¨×™×›×™× ×—×¡×¨×™ × ×™×¡×™×•×Ÿ ×©×œ× ××¢×‘×™×¨×™× ×‘×¤×•×¢×œ ×©×™×¢×•×¨×™×.
×”×©××™×œ×ª×” ××©×ª××©×ª ×‘×ª× ××™ `NOT IN` ×™×—×“ ×¢× ×©××™×œ×ª×” ×¤× ×™××™×ª ×”×‘×•×“×§×ª ××™×œ×• ××“×¨×™×›×™× ××•×¤×™×¢×™× ×‘×˜×‘×œ×ª ×”×©×™×¢×•×¨×™×.
**×¦×™×œ×•× ×”×¨×¦×”:**

![WhatsApp Image 2025-05-05 at 03 02 06](https://github.com/user-attachments/assets/1db9e862-f1ee-4a3b-86ca-bde6c8e973e2)
 

**×¦×™×œ×•× ×œ×¤× ×™:**  

![WhatsApp Image 2025-05-05 at 03 04 28](https://github.com/user-attachments/assets/3e617424-6b2a-4867-b9d0-35d519be6b22)



×ª×•×›×Ÿ ×˜×‘×œ×ª `Trainer` ×›×•×œ×œ ××“×¨×™×›×™× ×¢× × ×™×¡×™×•×Ÿ 1, ×©×œ× × ××¦××™× ×‘×˜×‘×œ×ª `Class`.


**×¦×™×œ×•× ××—×¨×™:**  

![WhatsApp Image 2025-05-05 at 03 03 48](https://github.com/user-attachments/assets/1eb535a9-df54-4082-8b78-82da8d0d1ddc)


××•×ª× ××“×¨×™×›×™× × ××—×§×™× ××”×˜×‘×œ×” ×œ××—×¨ ×”×”×¨×¦×”.

---

#### ğŸ”» ×©××™×œ×ª×” 2 â€“ ××—×™×§×ª ×× ×•×™×™× ×©×¤×’ ×ª×•×§×¤× ×•×”× ××¢×œ ×’×™×œ 30

**×ª×™××•×¨:**  
×‘×©××™×œ×ª×” ×–×• × ××—×§×™× ×× ×•×™×™× (`Member`) ××©×¨ ×ª×•×§×£ ×”×× ×•×™ ×©×œ×”× ×¤×’ ×œ×¤× ×™ ×™×•×ª×¨ ××©× ×”, ×•×’× ×’×™×œ× ××¢×œ 30.
×œ×©× ×›×š × ×¢×©×” ×©×™××•×© ×‘×©×ª×™ ×˜×‘×œ××•×ª â€“ `Member` ×•Ö¾`Person`: ×ª× ××™ ×”×’×™×œ × ×‘×“×§ ×¢×œ ×¤×™ ×©×“×” `DateOfBirth` ×‘×˜×‘×œ×ª `Person`.
**×¦×™×œ×•× ×”×¨×¦×”:** 

![WhatsApp Image 2025-05-05 at 03 05 41](https://github.com/user-attachments/assets/1c2a32ea-46dc-4190-9950-db925457b555)

**×¦×™×œ×•× ×œ×¤× ×™:**  

![WhatsApp Image 2025-05-05 at 03 07 07](https://github.com/user-attachments/assets/587ebe03-0527-4d3e-b9b4-e1223e0a72cd)


×˜×‘×œ×ª `Member` ×›×•×œ×œ×ª ×× ×•×™×™× ×©×ª×•×§×£ ×”×× ×•×™ ×©×œ×”× ×¤×’.  
×˜×‘×œ×ª `Person` ××¨××” ×›×™ ×”× ××¢×œ ×’×™×œ 30.

**×¦×™×œ×•× ××—×¨×™:**  

![WhatsApp Image 2025-05-05 at 03 06 39](https://github.com/user-attachments/assets/21a1886e-f6fa-444c-85c5-6eaf21b36e01)


××•×ª× ×× ×•×™×™× × ××—×§×™× ××˜×‘×œ×ª `Member`.

---

#### ğŸ”» ×©××™×œ×ª×” 3 â€“ ××—×™×§×ª ×©×™×¢×•×¨×™× ×©×œ× × ×¨×©××• ××œ×™×”× ×× ×•×™×™× ×‘×©× ×ª×™×™× ×”××—×¨×•× ×•×ª

**×ª×™××•×¨:**  
×‘×©××™×œ×ª×” ×–×• × ××—×§×™× ×©×™×¢×•×¨×™× (`Class`) ×©××œ×™×”× ×œ× × ×¨×©××• ×× ×•×™×™× ×‘×©× ×ª×™×™× ×”××—×¨×•× ×•×ª.  
××‘×•×¦×¢×ª ×‘×“×™×§×” ××•×œ ×˜×‘×œ×ª `registers_for`, ×ª×•×š ×©×™××•×© ×‘Ö¾`JOIN` ×œ×˜×‘×œ×ª `Member` ×›×“×™ ×œ×‘×“×•×§ ×ª××¨×™×š ×”×¨×©××” ×©×œ ×”×× ×•×™.
**×¦×™×œ×•× ×”×¨×¦×”:** 
![WhatsApp Image 2025-05-05 at 03 08 07](https://github.com/user-attachments/assets/a8c6affb-199e-4503-a95b-e89d87a72432)


**×¦×™×œ×•× ×œ×¤× ×™:**  
![WhatsApp Image 2025-05-05 at 03 09 25](https://github.com/user-attachments/assets/54fdec2a-5514-4227-a023-82987f6f73d8)


×˜×‘×œ×ª `Class` ×›×•×œ×œ×ª ×©×™×¢×•×¨×™×, ×•×—×œ×§× ×œ× × ×¨×©××• ××œ×™×”× ×›×œ×œ ×‘×©× ×ª×™×™× ×”××—×¨×•× ×•×ª.

**×¦×™×œ×•× ××—×¨×™:** 
![WhatsApp Image 2025-05-05 at 03 08 43](https://github.com/user-attachments/assets/88fce717-2bb5-45d1-b597-769755b7b51b)


×”×©×™×¢×•×¨×™× ×”××œ×• ×”×•×¡×¨×• ××”×˜×‘×œ×” ×œ××—×¨ ×”×”×¨×¦×”.




### ×©××™×œ×ª×•×ª UPDATE

#### â– ×©××™×œ×ª×” 1 â€“ ×”××¨×›×ª ×× ×•×™ ×œ×—×‘×¨×™× ×•×ª×™×§×™×

**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××–×”×”×” ××ª ×”×× ×•×™×™× ×©×‘×™×Ÿ ×ª××¨×™×š ×”×¨×©××” ×œ×ª××¨×™×š ×¤×§×¢×”× ×”×× ×•×™ ×¢×‘×¨×• ×œ××¢×œ×” ××©× ×ª×™×™× (730 ×™××™× â‰ˆ 2 ×©× ×™×). ×× ×•×™×™× ××œ×” ××§×‘×œ×™× "××ª× ×”" â€“ ×”××¨×›×ª ×”×× ×•×™ ×‘×—×•×“×©×™×™×.

**×¦×™×œ×•× ×”×¨×¦×ª ×”×©××™×œ×ª×”:**


![WhatsApp Image 2025-05-05 at 12 48 42](https://github.com/user-attachments/assets/2f085b6f-f924-4e84-b533-3c013c9ef8c0)

```sql
SELECT *
FROM Member
WHERE ExpirationDate - RegistrationDate > 365;
```

**×œ×¤× ×™ ×”×¢×“×›×•×Ÿ:**
(×¦×™×œ×•× ×”××¡×š ×™×¨××” ××ª ×ª××¨×™×›×™ RegistrationDate ×•â€ExpirationDate ×©×œ ×”×× ×•×™×™× ×¨×œ×•×•× ×˜×™×™×)

![WhatsApp Image 2025-05-05 at 12 53 41](https://github.com/user-attachments/assets/db911099-a748-4f28-a49d-0747a0257cbd)



**××—×¨×™ ×”×¢×“×›×•×Ÿ:**
(×¦×™×œ×•× ××¡×š × ×•×¡×£ ×©×œ ××•×ª×” ×”×©××™×œ×ª×” â€“ ×”×¦×•×’ ×©×œâ€ExpirationDate ×”×•×¦× ×—×•×“×©×™×™× ×§×“×™××”)

![WhatsApp Image 2025-05-05 at 12 52 46](https://github.com/user-attachments/assets/3ec2f919-17ef-4068-a4c4-195f3c7de520)


---

#### â– ×©××™×œ×ª×” 2 â€“ ×§×™×“×•× ××“×¨×™×›×™× ×¢×œ ×¡××š ×¤×¢×™×œ×•×ª

**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××–×”×”×” ××“×¨×™×›×™× ×©×”×¢×‘×™×¨×• ×œ××¢×œ×” ××™-100 ×©×™×¢×•×¨×™× ×‘×©× ×” ×”××—×¨×•× ×”. ×œ××“×¨×™×›×™× ××œ×” ×ª×¢×œ×” ×¨××ª ×”× ×™×¡×™×•×Ÿ ×‘×¢×“ ×“×¨×’×” ××—×ª, ×¢×“ ×œ××§×¡×™××•× ×©×œ ×“×¨×’×” 3.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-05-05 at 18 31 45](https://github.com/user-attachments/assets/11b213d9-7c95-4d0c-be14-8f83d9289b7f)


**×ª×•×¦××•×ª ×”×©××™×œ×ª×”:**

```sql
SELECT
  T.Id,
  T.ExperienceLevel AS current_experience,
  LEAST(T.ExperienceLevel + 1, 3) AS new_experience
FROM Trainer T
WHERE T.Id IN (
  SELECT Id
  FROM Class
  GROUP BY Id
  HAVING COUNT(*) * 4 * 12 >= 100
);
```

**×œ×¤× ×™ ×”×¢×“×›×•×Ÿ:**
(×¦×™×œ×•× ×©××¨× ××ª ExperienceLevel ×”× ×•×›×—×™ ×•××ª ×”×“×¨×’×” ×”×—×“×©×”)

![WhatsApp Image 2025-05-05 at 13 20 08](https://github.com/user-attachments/assets/bd8fca6a-06b7-42d0-b398-f2203c095981)


**××—×¨×™ ×”×¢×“×›×•×Ÿ:**
(×¦×™×œ×•× ×—×•×–×¨ â€“ ×©××¨× ×©×”×“×¨×’×” ×¢×•×“×›× ×”)

![WhatsApp Image 2025-05-05 at 13 19 31](https://github.com/user-attachments/assets/24d21797-cb31-4d6e-aaec-cc774c892867)




---

#### â– ×©××™×œ×ª×” 3 â€“ ×”×—×œ×¤×ª ×¦×™×•×“ ×ª×§×•×œ ×‘×¦×™×•×“ ×ª×§×™×Ÿ ××—×¨

**×ª×™××•×¨:**
×”×©××™×œ×ª×” ××—×œ×™×¤×” ×¦×™×•×“ ×ª×§×•×œ (×‘×¢×œ ××–×”×” IdE = 58) ×‘×¦×™×•×“ ×ª×§×™×Ÿ ××—×¨ ×©×‘×¢×œ ××•×ª×• ×©× (NameE) ×•×©××™× ×• ××©×•×‘×¥ ×œ××£ ×—×“×¨ (×›×œ××© IdR IS NULL). ×”×¦×™×•×“ ×”×—×œ×•×¤×™ ××©×•×™×š ×œ×—×“×¨ ×©××œ×™×• ×©×™×™×š ×”×¦×™×•×“ ×”×ª×§×•×œ.

**×”×¨×¦×ª ×”×©××™×œ×ª×”:**

![WhatsApp Image 2025-05-05 at 14 29 45](https://github.com/user-attachments/assets/c71a45d8-3616-457b-a44e-2125d17076d4)

**×ª×•×¦××ª ×”×©××™×œ×ª×”:**

```sql
SELECT *
FROM Equipment
WHERE IdE = 11 OR IdE = 58;
```

**×œ×¤× ×™ ×”×¢×“×›×•×Ÿ:**
(×¦×™×œ×•× ×©×‘×• × ×™×ª×Ÿ ×œ×¨××•×ª ××ª ×”×¦×™×•×“ ×”×ª×§×•×œ IdE = 58 ×•××ª ×”×¦×™×•×“ ×”×—×œ×•×¤×™ IdE = 11 ×¢× IdR = NULL)

![WhatsApp Image 2025-05-05 at 14 28 58](https://github.com/user-attachments/assets/2089cf2a-e04e-4efb-ad2b-2b129b3ff7b9)


**××—×¨×™ ×”×¢×“×›×•×Ÿ:**
(×¦×™×œ×•× ×©××¨× ×©×¦×™×•×“ 11 ×¢×•×“×›×Ÿ ×›×™ IdR ×©×œ×• ×–×”×” ×œ-IdR ×©×œ ×¦×™×•×“ 58)
![WhatsApp Image 2025-05-05 at 14 30 21](https://github.com/user-attachments/assets/4b5dc4bb-fbf7-4865-9a4a-52341e70953e)




### ××™×œ×•×¦×™×

ğŸ“œ [×¦×¤×™×™×” ×‘×§×•×‘×¥ ×”××™×œ×•×¦×™×-`Constraints.sql`](Stage2)


### ××™×œ×•×¥ 1 ×¢×œ ×”×˜×‘×œ×” - Room 
**×ª×™××•×¨ ×”×©×™× ×•×™:**
×”×•×¡×¤× ×• ××™×œ×•×¥ ×©×‘×•×“×§ ×©×§×™×‘×•×œ×ª ×—×“×¨ ×”×™× ×¢×¨×š ×—×™×•×‘×™ ×•×œ× ×’×“×•×œ×” ×-200.

**×¤×§×•×“×ª ALTER TABLE:**
```sql
ALTER TABLE Room
ADD CONSTRAINT chk_capacity_positive CHECK (Capacity > 0 AND Capacity <= 200);
```

**× ×™×¡×™×•×Ÿ ×œ×”×›× ×™×¡ × ×ª×•×Ÿ ×œ× ×—×•×§×™:**
```sql
INSERT INTO Room (IdR, NameR, Capacity)
VALUES (402, 'SmallRoom', 0);
```

**××” ×™×§×¨×”:**
×©×’×™××” â€” ×”××™×œ×•×¥ `chk_capacity_positive` ×™×•×¤×¢×œ ×•×ª×ª×§×‘×œ ×”×•×“×¢×”:

![WhatsApp Image 2025-04-27 at 19 02 56](https://github.com/user-attachments/assets/61569dc4-e935-432e-8c2d-b011357fd29d)


---

### ××™×œ×•×¥ 2 ×¢×œ ×”×˜×‘×œ×” - Equipment 
**×ª×™××•×¨ ×”×©×™× ×•×™:**
×©×™× ×™× ×• ××ª ×¢××•×“×ª `Condition` ×›×š ×©×× ×œ× ×™×•×–×Ÿ ×¢×¨×š â€” ×™×•×’×“×¨ ××•×˜×•××˜×™×ª ×›-'T' (×ª×§×™×Ÿ).

**×¤×§×•×“×ª ALTER TABLE:**
```sql
ALTER TABLE Equipment
ALTER COLUMN Condition SET DEFAULT 'T';
```

**× ×™×¡×™×•×Ÿ ×œ×”×›× ×™×¡ ×¦×™×•×“ ×‘×œ×™ ×œ×¦×™×™×Ÿ Condition:**
```sql
INSERT INTO Equipment (IdE, NameE, IdR)
VALUES (201, 'Treadmill', 1);
```

**××” ×™×§×¨×”:**

×œ× ×ª×”×™×” ×©×’×™××”! 
![WhatsApp Image 2025-04-27 at 19 19 01](https://github.com/user-attachments/assets/600b64e1-6afa-4ea4-8e76-bb8e7d73f27b)

×¤×©×•×˜ ×™×ª×•×•×¡×£ ×œ×¨×©×•××” ×¢×¨×š ×‘×¨×™×¨×ª ××—×“×œ `Condition = 'T'`.

×ª×•×¦××ª ×”×©××™×œ×ª× ` ;SELECT * FROM Equipment WHERE IdE = 402` :

![WhatsApp Image 2025-04-27 at 19 41 32](https://github.com/user-attachments/assets/b8435748-ab4b-4342-8eae-e306b5bcc2c4)

---

### ××™×œ×•×¥ 3 ×¢×œ ×”×˜×‘×œ×” - Member
**×ª×™××•×¨ ×”×©×™× ×•×™:**
× ×•×¡×£ ××™×œ×•×¥ ×©×‘×•×“×§ ×©-`ExpirationDate` ×’×“×•×œ ×-`RegistrationDate`.

**×¤×§×•×“×ª ALTER TABLE:**
```sql
ALTER TABLE Member
ADD CONSTRAINT chk_member_dates CHECK (ExpirationDate > RegistrationDate);
```

**× ×™×¡×™×•×Ÿ ×œ×”×›× ×™×¡ × ×ª×•×Ÿ ×œ× ×—×•×§×™:**
```sql
INSERT INTO Member (Id, RegistrationDate, ExpirationDate)
VALUES (402, '2025-05-01', '2025-04-01');
```

**××” ×™×§×¨×”:**
×ª×ª×§×‘×œ ×©×’×™××” ×¢×œ ×”×¤×¨×ª ×”××™×œ×•×¥:


![WhatsApp Image 2025-04-27 at 19 44 59](https://github.com/user-attachments/assets/f57b0240-2d5e-4451-8265-81e35cef354e)


### ×‘×™×¦×•×¢ Rollback ×•Commit

ğŸ“œ [×¦×¤×™×™×” ×‘×§×•×“-`RollbackCommit.sql`](Stage2)

#### ×‘×™×¦×•×¢ ×¢×“×›×•×Ÿ ×¢× ROLLBACK

#### 1. ×”×¦×’×ª ××¦×‘ ×˜×‘×œ×ª Room ×œ×¤× ×™ ×”×¢×“×›×•×Ÿ:
×‘×™×¦×¢× ×• ×©××™×œ×ª×” ×œ×”×¦×’×ª ×›×œ×œ ×”×¨×©×•××•×ª ×‘×˜×‘×œ×ª Room. ×‘×©×œ×‘ ×–×” × ×™×ª×Ÿ ×œ×¨××•×ª ××ª ×”××¦×‘ ×”××§×•×¨×™ ×©×œ ×”×—×“×¨×™× ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×, ×œ×¤× ×™ ×›×œ ×©×™× ×•×™.


![WhatsApp Image 2025-04-28 at 11 54 21](https://github.com/user-attachments/assets/776e5f7f-03d6-4f26-be92-f4aa26788503)



#### 2. ×‘×™×¦×•×¢ ×¢×“×›×•×Ÿ:
×¢×“×›× ×• ××ª ×©× ×”×—×“×¨ ×‘×¢×œ ×”××–×”×” IdR = 1 ×œ- 'BeforeRollback'.

#### 3. ×”×¦×’×ª ××¦×‘ ×˜×‘×œ×ª Room ×œ××—×¨ ×”×¢×“×›×•×Ÿ:

![WhatsApp Image 2025-04-28 at 03 44 11](https://github.com/user-attachments/assets/c877402f-a937-4641-b578-1cc80cd1f95b)


×‘×©×œ×‘ ×–×”, ×œ××—×¨ ×‘×™×¦×•×¢ ×¤×§×•×“×ª ×”×¢×“×›×•×Ÿ, ×©× ×”×—×“×¨ ×¢× ××–×”×” 1 ×”×©×ª× ×” ×œ- 'BeforeRollback'. ×¢× ×–××ª, ×××—×¨ ×©×˜×¨× ×–×§×¦×™×” ×–×• ×˜×¨× ×‘×•×¦×¢×” COMMIT, ×”×¢×“×›×•×Ÿ ×¢×“×™×™×Ÿ ×œ× × ×©××¨ ×œ×¦××™×ª×•×ª ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×.

#### 4. ×‘×™×¦×•×¢ ROLLBACK:
×”×¤×¢×œ× ×• ××ª ×¤×§×•×“×ª ROLLBACK, ××©×¨ ××‘×˜×œ×ª ××ª ×›×œ ×”×©×™× ×•×™×™× ×©×‘×•×¦×¢×• ×××– ×ª×—×™×œ×ª ×”×˜×¨× ×–×§×¦×™×”. ×‘×›×š ×—×–×¨ ×‘×¡×™×¡ ×”× ×ª×•× ×™× ×œ××¦×‘×• ×”×§×•×“×.

#### 5. ×”×¦×’×ª ××¦×‘ ×˜×‘×œ×ª Room ×œ××—×¨ ×”-ROLLBACK:
×‘×™×¦×¢× ×• ×©×•×‘ ×©××™×œ×ª×” ×œ×”×¦×’×ª ×ª×•×›×Ÿ ×”×˜×‘×œ×”. × ×™×ª×Ÿ ×œ×¨××•×ª ×©×”×©×™× ×•×™ ×©×‘×•×¦×¢ ×”×ª×‘×˜×œ ×•×”××™×“×¢ ×‘×˜×‘×œ×” ×—×–×¨ ×œ×”×™×•×ª ×›×¤×™ ×©×”×™×” ×œ×¤× ×™ ×”×¢×“×›×•×Ÿ.

![WhatsApp Image 2025-04-28 at 03 47 08](https://github.com/user-attachments/assets/31a4be2b-2a55-4cc7-af7f-9c264f15c520)


---

#### ×‘×™×¦×•×¢ ×¢×“×›×•×Ÿ ×¢× COMMIT

#### 1. ×”×¦×’×ª ××¦×‘ ×˜×‘×œ×ª Room ×œ×¤× ×™ ×”×¢×“×›×•×Ÿ:
×‘×™×¦×¢× ×• ×©×•×‘ ×©××™×œ×ª×” ×œ×”×¦×’×ª ×ª×•×›×Ÿ ×”×˜×‘×œ×”, ×œ×•×•×“× ×©×× ×• ××ª×—×™×œ×™× ××”××¦×‘ ×”×¢×“×›× ×™ ×•×”××§×•×¨×™ ×œ××—×¨ ×”-ROLLBACK.

![WhatsApp Image 2025-04-28 at 12 23 15](https://github.com/user-attachments/assets/52bbcfa6-d852-4aa7-afe5-9d718e764356)


#### 2. ×‘×™×¦×•×¢ ×¢×“×›×•×Ÿ:
×‘×™×¦×¢× ×• ×¢×“×›×•×Ÿ × ×•×¡×£ ×¢×œ ×˜×‘×œ×ª Room, ×”×¤×¢× ×©×™× ×™× ×• ××ª ×§×™×‘×•×œ×ª ×”×—×“×¨ ×‘×¢×œ ××–×”×” IdR = 1 ×œ- 45.

#### 3. ×”×¦×’×ª ××¦×‘ ×˜×‘×œ×ª Room ×œ××—×¨ ×”×¢×“×›×•×Ÿ:
×œ××—×¨ ×”×¢×“×›×•×Ÿ, ×”×§×•×‘×œ×ª ××›×Ÿ ×”×©×ª× ×ª×” ×œ-45. ×”×©×™× ×•×™ ×¢×“×™×™×Ÿ ×–×× ×™ ×¢×“ ×‘×™×¦×•×¢ COMMIT.


![WhatsApp Image 2025-04-28 at 12 36 04](https://github.com/user-attachments/assets/528df950-c1c4-40af-aaba-171d9f02d813)



#### 4. ×‘×™×¦×•×¢ COMMIT:
×”×¨×¦× ×• ××ª ×¤×§×•×“×ª COMMIT, ××©×¨ ×××©×¨×ª ××ª ×›×œ ×”×©×™× ×•×™×™× ×©×‘×•×¦×¢×• ×‘×˜×¨× ×–×§×¦×™×” ×•××‘×¦×¢×ª ××•×ª× ×œ×¦××™×ª×•×ª ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×.

#### 5. ×”×¦×’×ª ××¦×‘ ×˜×‘×œ×ª Room ×œ××—×¨ ×”-COMMIT:
×œ××—×¨ ×‘×™×¦×•×¢ ×”-COMMIT, ×‘×¦×¢× ×• ×©×•×‘ ×©××™×œ×ª×” ×¢×œ ×”×˜×‘×œ×” ×•×¨××™× ×• ×›×™ ×§×™×‘×œ×ª ×”×—×“×¨ ×¢×•×“×›× ×” ×œ- 45 ×‘××•×¤×Ÿ ×§×‘×•×¢.

![WhatsApp Image 2025-04-28 at 12 41 33](https://github.com/user-attachments/assets/f24b2b5e-0e2e-4f43-afb7-5a4a6a3d9990)





### ×’×™×‘×•×™ ××¢×•×“×›×Ÿ

ğŸ“œ [×œ×”×•×¨×“×ª ×§×•×‘×¥ ×”×’×™×‘×•×™-`backup_05_05_25_18_19`](Stage2)



## ×©×œ×‘ 3: ××™× ×˜×’×¨×¦×™×” ×•××‘×˜×™×


### ××‘×•×

×‘××¡×’×¨×ª ×©×œ×‘ ×’' ×©×œ ×”×¤×¨×•×™×§×˜, ×‘×™×¦×¢× ×• ××™× ×˜×’×¨×¦×™×” ×©×œ ×©× ×™ ××¢×¨×›×•×ª ×‘×¡×™×¡×™ × ×ª×•× ×™× ×¢×¦×××™×•×ª:
- **××¢×¨×›×ª ××§×•×¨×™×ª**: ××¢×¨×›×ª × ×™×”×•×œ ××›×•×Ÿ ×›×•×©×¨
- **××¢×¨×›×ª ×—×“×©×”**: ××¢×¨×›×ª × ×™×”×•×œ ×—×•×’×™ ×¡×¤×•×¨×˜

×”××˜×¨×”: ×œ×™×¦×•×¨ ××¢×¨×›×ª ××©×•×œ×‘×ª ××—×ª ×”××›×™×œ×” ××ª ×›×œ ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×©×œ ×©×ª×™ ×”××¢×¨×›×•×ª, ×ª×•×š ×©××™×¨×” ×¢×œ ×ª×§×™× ×•×ª ×”× ×ª×•× ×™× ×•×”×™×—×¡×™× ×‘×™× ×™×”×.

---
### ×ª×¨×©×™× DSD ×©×œ ×”××¢×¨×›×ª ×”×—×“×©×” (×—×•×’×™ ×¡×¤×•×¨×˜)
![DSDSportClasses](https://github.com/user-attachments/assets/5e12ef0b-c928-4dd9-a149-41bd2b7228c3)

---

### ×ª×”×œ×™×š ×”× ×“×¡×” ×”×¤×•×›×” (Reverse Engineering)


### ×©×œ×‘ 1: ×™×¦×™×¨×ª DSD ××’×™×‘×•×™ ×”××¡"×“ ×©×§×™×‘×œ× ×•

××ª×•×š ×”×§×•×‘×¥ `CreateTables.sql`  ×•××”-DSD ×©×™×ª×•×•×¦×¨×• ××•×˜×•××˜×™×ª ××”×’×™×‘×•×™, ×–×™×”×™× ×• ××ª ×”×˜×‘×œ××•×ª ×”×‘××•×ª:

#### ×˜×‘×œ××•×ª ×”×œ×™×‘×”:
- **person**: ××›×™×œ×” ×¤×¨×˜×™ ×× ×©×™× ×‘×¡×™×¡×™×™×
- **course**: ××›×™×œ×” ×¤×¨×˜×™ ×§×•×¨×¡×™×
- **studio**: ××›×™×œ×” ×¤×¨×˜×™ ××•×œ××•×ª
- **timeslot**: ××›×™×œ×” ×–×× ×™ ×”×©×™×¢×•×¨×™×
- **equipment**: ××›×™×œ×” ×¤×¨×˜×™ ×¦×™×•×“

#### ×˜×‘×œ××•×ª ×”×ª××—×•×ª:
- **participant**: ×™×•×¨×©×ª ×-person (××ª××× ×™×)
- **trainer**: ×™×•×¨×©×ª ×-person (××“×¨×™×›×™×)

#### ×˜×‘×œ××•×ª ×§×™×©×•×¨:
- **class**: ×©×™×¢×•×¨ (×™×©×•×ª ×—×œ×©×”)
- **enrolled**: ×¨×™×©×•× ×œ××©×ª×ª×¤×™×
- **require**: ×“×¨×™×©×•×ª ×¦×™×•×“ ×œ×§×•×¨×¡×™×

### ×©×œ×‘ 2: ×–×™×”×•×™ ×¡×•×’×™ ×”×™×©×•×™×•×ª

#### ×™×©×•×™×•×ª ×¨×’×™×œ×•×ª:
```sql
-- ××–×•×”×•×ª ×¢×œ ×¤×™ ××¤×ª×— ×¨××©×™ ×¤×©×•×˜
person: PRIMARY KEY (person_id)
course: PRIMARY KEY (course_id)
studio: PRIMARY KEY (studio_id)
timeslot: PRIMARY KEY (timeslot_id)
equipment: PRIMARY KEY (eq_id)
```

#### ×™×©×•×ª ×—×œ×©×”:
```sql
-- ××–×•×”×™×ª ×¢×œ ×¤×™ ××¤×ª×— ×¨××©×™ ××•×¨×›×‘ ×××¤×ª×—×•×ª ×–×¨×™×
class: PRIMARY KEY (timeslot_id, studio_id)
```

**×”×¡×‘×¨ ×œ××” Class ×”×™× ×™×©×•×ª ×—×œ×©×”:**
1. ×”××¤×ª×— ×”×¨××©×™ ××•×¨×›×‘ ××©× ×™ ××¤×ª×—×•×ª ×–×¨×™×
2. ××™×Ÿ ××–×”×” ×¢×¦×××™ ×œ×©×™×¢×•×¨
3. ×§×™×•× ×”×©×™×¢×•×¨ ×ª×œ×•×™ ×‘××§×•× ×•×‘×–××Ÿ, ×•×œ× "×¡×•×’ ×©×œ", ×›×œ×•××¨ ×”×™×—×¡ ×”×•× ×œ× ×™×¨×•×©×”
4. ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×©×™×¢×•×¨ ×œ×œ× timeslot ×•-studio

##### ×™×—×¡×™ ×™×¨×•×©×” (ISA):
```sql
-- ××–×•×”×™× ×›××©×¨ ×”××¤×ª×— ×”×¨××©×™ ×”×•× ×’× ××¤×ª×— ×–×¨
participant: PRIMARY KEY (person_id) + FOREIGN KEY â†’ person
trainer: PRIMARY KEY (person_id) + FOREIGN KEY â†’ person
```

#### ×©×œ×‘ 3: ×–×™×”×•×™ ×™×—×¡×™×

##### ×™×—×¡×™ 1:N:
- **course â†’ class**: ×§×•×¨×¡ ××—×“ ×™×›×•×œ ×œ×”×™×•×ª ×‘×›××” ×©×™×¢×•×¨×™×
- **trainer â†’ class**: ××“×¨×™×š ××—×“ ×™×›×•×œ ×œ×œ××“ ×›××” ×©×™×¢×•×¨×™×
- **timeslot â†’ class**: ×–××Ÿ ××—×“ ×™×›×•×œ ×œ×›×œ×•×œ ×›××” ×©×™×¢×•×¨×™× (×‘××•×œ××•×ª ×©×•× ×™×)
- **studio â†’ class**: ××•×œ× ××—×“ ×™×›×•×œ ×œ××¨×— ×›××” ×©×™×¢×•×¨×™× (×‘×–×× ×™× ×©×•× ×™×)

##### ×™×—×¡×™ M:N:
- **participant â†” class** (×“×¨×š enrolled): ××ª×××Ÿ ×™×›×•×œ ×œ×”×™×¨×©× ×œ×›××” ×©×™×¢×•×¨×™×, ×©×™×¢×•×¨ ×™×›×•×œ ×œ×›×œ×•×œ ×›××” ××ª××× ×™×
- **course â†” equipment** (×“×¨×š require): ×§×•×¨×¡ ×™×›×•×œ ×œ×“×¨×•×© ×›××” ×¦×™×•×“×™×, ×¦×™×•×“ ×™×›×•×œ ×œ×©××© ×›××” ×§×•×¨×¡×™×

---

### ×ª×¨×©×™× ERD ×©×œ ×”××¢×¨×›×ª ×”×—×“×©×”
![sportClassesERD](https://github.com/user-attachments/assets/f8c409a7-d4ef-43f2-a964-3ee19926da08)

---

### × ×™×ª×•×— ×•×”×©×•×•××ª ×”××¢×¨×›×•×ª

#### ××¢×¨×›×ª ××§×•×¨×™×ª (××›×•×Ÿ ×›×•×©×¨):
**×™×©×•×™×•×ª ×¢×™×§×¨×™×•×ª:**
- Person (×‘×¡×™×¡)
- Member, Trainer (×”×ª××—×•×™×•×ª)
- ClassType (×¡×•×’×™ ×©×™×¢×•×¨×™×)
- Room (×—×“×¨×™×)
- Equipment (×¦×™×•×“)
- Class (×©×™×¢×•×¨×™×)

**×××¤×™×™× ×™×:**
- ××›×•×•×Ÿ ×œ× ×™×”×•×œ ×—×‘×¨×•×ª
- ×“×’×© ×¢×œ ×—×“×¨×™× ×¤×™×–×™×™×
- ××¢×¨×›×ª ×¡×™×•×•×’ ×¤×©×•×˜×” ×©×œ ×©×™×¢×•×¨×™×

#### ××¢×¨×›×ª ×—×“×©×” (×©×™×¢×•×¨×™ ×¡×¤×•×¨×˜):
**×™×©×•×™×•×ª ×¢×™×§×¨×™×•×ª:**
- Person (×‘×¡×™×¡)
- Participant, Trainer (×”×ª××—×•×™×•×ª)
- Course (×§×•×¨×¡×™× ××¤×•×¨×˜×™×)
- Studio (××•×œ××•×ª)
- TimeSlot (×–×× ×™× ××•×‘× ×™×)
- Equipment (×¦×™×•×“ ××ª×§×“×)
- Class (×©×™×¢×•×¨×™× ××•×¨×›×‘×™×)

**×××¤×™×™× ×™×:**
- ××›×•×•×Ÿ ×œ××’×•×•×Ÿ ×—×•×’×™ ×¡×¤×•×¨×˜ ×‘××™×§×•××™× ×©×•× ×™× ×•×œ× ××›×•×Ÿ ××—×“
- ×“×’×© ×¢×œ ×ª×–××•×Ÿ ××“×•×™×§
- ××¢×¨×›×ª ××—×™×¨×™× ××¤×•×¨×˜×ª

---

## ×ª×¨×©×™× ERD ××©×•×œ×‘
![IntegrationERD](https://github.com/user-attachments/assets/bdc65ebc-f68d-498f-9716-2edd91a965b0)


## ×ª×”×œ×™×š ×”××™× ×˜×’×¨×¦×™×”

ğŸ“œ [×¦×¤×™×™×” ×‘×§×•×“ ×”××™× ×˜×’×¨×¦×™×” ×”××œ×-`Integrate.sql`](Stage3)

### ×©×œ×‘ 1: ×–×™×”×•×™ × ×§×•×“×•×ª ×”××¤×’×©

**×™×©×•×™×•×ª ×–×”×•×ª:**
- Person â†” Person
- Member â†” Participant
- Trainer â†” Trainer
- Equipment â†” Equipment
- Class â†” Class

**×™×©×•×™×•×ª ×“×•××•×ª:**
- ClassType â†” Course
- Room â†” Studio
- (×—×¡×¨) â†” TimeSlot

#### ×©×œ×‘ 2: ×”×—×œ×˜×•×ª ××™×–×•×’

##### ×”×—×œ×˜×” 1: ××™×–×•×’ Person
**×‘×¢×™×”:** ×©×ª×™ ×”××¢×¨×›×•×ª ××›×™×œ×•×ª ×˜×‘×œ×ª Person ×¢× ×©×“×•×ª ×©×•× ×™×
**×¤×ª×¨×•×Ÿ:** ×”×©×œ××ª ×”×©×“×•×ª ×”×—×¡×¨×™×
```sql
-- ×”×•×¡×¤×ª ×©×“×•×ª ×—×¡×¨×™× ×œ××¢×¨×›×ª ×”××§×•×¨×™×ª
ALTER TABLE Person ADD COLUMN email VARCHAR(100);
ALTER TABLE Person ADD COLUMN phone VARCHAR(20);
```

##### ×”×—×œ×˜×” 2: ××™×—×•×“ ClassType ×•-Course
**×‘×¢×™×”:** ×©×ª×™ ××¢×¨×›×•×ª ×©×•× ×•×ª ×œ×ª×™××•×¨ ×¡×•×’×™ ×©×™×¢×•×¨×™×
**×¤×ª×¨×•×Ÿ:** ×™×¦×™×¨×ª ×˜×‘×œ×ª Course ×××•×—×“×ª ×¢× ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×
```sql
CREATE TABLE Course (
    course_id integer,
    course_name VARCHAR(50),
    required_experience NUMERIC(1,0),
    min_age NUMERIC(2,0),
    price NUMERIC(6,2),
    PRIMARY KEY (course_id)
);
```

##### ×”×—×œ×˜×” 3: ×™×¦×™×¨×ª TimeSlot
**×‘×¢×™×”:** ×”××¢×¨×›×ª ×”××§×•×¨×™×ª ×œ× ××›×™×œ×” × ×™×”×•×œ ×–×× ×™× ××•×‘× ×”
**×¤×ª×¨×•×Ÿ:** ×™×¦×™×¨×ª ×˜×‘×œ×ª TimeSlot ×—×“×©×” ×•××™×¤×•×™ ×”× ×ª×•× ×™× ×”×§×™×™××™×
```sql
CREATE TABLE TimeSlot (
    timeslot_id integer,
    day character varying(15),
    start_time character varying(15),
    end_time character varying(15),
    PRIMARY KEY (timeslot_id)
);
```

##### ×”×—×œ×˜×” 4: ××™×—×•×“ Room ×•-Studio
**×‘×¢×™×”:** ×©×ª×™ ××¢×¨×›×•×ª ×œ××™×§×•××™× ×¤×™×–×™×™×
**×¤×ª×¨×•×Ÿ:** ×©××™×¨×” ×¢×œ ×©×ª×™ ×”×˜×‘×œ××•×ª ×¢× ×§×©×¨ ×‘×™× ×™×”×Ÿ - ×‘×ª×•×š ×¡×˜×•×“×™×•/××›×•×Ÿ ×™×© ×›××” ×—×“×¨×™×
- Room - ×—×“×¨×™× ×¤×™×–×™×™×
- Studio - ××§×•××•×ª ××•×©×’×™×™× ×¢× ××™×§×•×

---

#### ×ª×”×œ×™×š ××™×¤×•×™ ×”× ×ª×•× ×™×

#### ××™×¤×•×™ ××–×”×™×
×›×“×™ ×œ×× ×•×¢ ×”×ª× ×’×©×•×™×•×ª ×‘××–×”×™×, ×”×©×ª××©× ×• ×‘×”×¡×˜×”:
```sql
-- ××–×”×™ ×× ×©×™×: +1000
INSERT INTO Person (person_id, ...)
SELECT (person_id + 1000), ...
FROM person_remote;

-- ××–×”×™ ×§×•×¨×¡×™×: +1000
INSERT INTO Course (course_id, ...)
SELECT (course_id + 1000), ...
FROM course_remote;

-- ××–×”×™ ×¦×™×•×“: +1000
INSERT INTO Equipment (eq_id, ...)
SELECT (eq_id + 1000), ...
FROM equipment_remote;
```

#### ××™×¤×•×™ × ×ª×•× ×™× ×—×¡×¨×™×
```sql
-- ×”×©×œ××ª ××™××™×™×œ×™× ×•×˜×œ×¤×•× ×™× ××§×¨××™×™×
UPDATE Person
SET email = LOWER(SUBSTRING(REPLACE(person_name, ' ', ''), 1, 5)) 
           || FLOOR(random()*10000)::int || '@gmail.com',
    phone = '05' || FLOOR(random()*100000000)::int
WHERE email IS NULL OR phone IS NULL;
```

#### ×™×¦×™×¨×ª ×§×©×¨×™× ×—×“×©×™×
```sql
-- ×§×™×©×•×¨ ×©×™×¢×•×¨×™× ×œ×–×× ×™× ×—×“×©×™×
UPDATE Class c
SET timeslot_id = t.timeslot_id
FROM TimeSlot t
WHERE c.DayInWeek = t.day
  AND TO_CHAR(TO_TIMESTAMP(t.start_time, 'HH24:MI'), 'HH24') = LPAD(c.HourC, 2, '0');
```

---

### ×”×¡×‘×¨ ×”×¤×§×•×“×•×ª SQL

#### ×©×œ×‘ 1: ×”×›× ×ª ×”×¡×‘×™×‘×”
```sql
-- ×™×¦×™×¨×ª ×—×™×‘×•×¨ ×œ××¡×“ ×”× ×ª×•× ×™× ×”××¨×•×—×§
CREATE EXTENSION IF NOT EXISTS postgres_fdw;
CREATE SERVER sportclasses_server
FOREIGN DATA WRAPPER postgres_fdw
OPTIONS (host 'localhost', dbname 'sport', port '5432');
```

**×”×¡×‘×¨:** ×™×¦×™×¨×ª ×ª×©×ª×™×ª ×œ×—×™×‘×•×¨ ×‘×™×Ÿ ×©× ×™ ××¡×“×™ × ×ª×•× ×™× ×‘×××¦×¢×•×ª Foreign Data Wrapper.

#### ×©×œ×‘ 2: ×™×¦×™×¨×ª ×˜×‘×œ××•×ª ×–×¨×•×ª
```sql
CREATE FOREIGN TABLE person_remote (
    person_id integer,
    person_name character varying(80),
    -- ×©××¨ ×”×©×“×•×ª...
) SERVER sportclasses_server
OPTIONS (schema_name 'public', table_name 'person');
```

**×”×¡×‘×¨:** ×™×¦×™×¨×ª "×—×œ×•× ×•×ª" ×œ×˜×‘×œ××•×ª ×‘××¡×“ ×”× ×ª×•× ×™× ×”××¨×•×—×§, ×”×××¤×©×¨×•×ª ×§×¨×™××” ×™×©×™×¨×” ××”×˜×‘×œ××•×ª ×”××§×•×¨×™×•×ª.

#### ×©×œ×‘ 3: ×”×›× ×ª ×”××‘× ×”
```sql
-- ×”×¡×¨×ª ××™×œ×•×¦×™× ×œ×¤× ×™ ×©×™× ×•×™×™×
ALTER TABLE registers_for DROP CONSTRAINT registers_for_pkey;

-- ×©×™× ×•×™ ×¡×•×’×™ × ×ª×•× ×™×
ALTER TABLE Person ALTER COLUMN Id TYPE INTEGER;

-- ×”×—×–×¨×ª ××™×œ×•×¦×™×
ALTER TABLE Person ADD PRIMARY KEY (Id);
```

**×”×¡×‘×¨:** ×ª×”×œ×™×š ××‘×•×§×¨ ×©×œ ×©×™× ×•×™ ××‘× ×” ×”×˜×‘×œ××•×ª ×ª×•×š ×©××™×¨×” ×¢×œ ×ª×§×™× ×•×ª ×”× ×ª×•× ×™×.

#### ×©×œ×‘ 4: ×”×¢×‘×¨×ª × ×ª×•× ×™×
```sql
INSERT INTO Person (person_id, person_name, Gender, birth_date, email, phone)
SELECT 
    (person_id + 1000), 
    person_name, 
    CASE 
        WHEN LOWER(gender) = 'male' THEN 'M'
        WHEN LOWER(gender) = 'female' THEN 'F'
        ELSE NULL
    END,
    birth_date, 
    email, 
    phone
FROM person_remote
WHERE (person_id + 1000) NOT IN (SELECT person_id FROM Person);
```

**×”×¡×‘×¨:** ×”×¢×‘×¨×ª × ×ª×•× ×™× ×¢× ×”×ª×××•×ª:
- ×”×¡×˜×ª ××–×”×™× ×œ×× ×™×¢×ª ×”×ª× ×’×©×•×™×•×ª
- ×”××¨×ª ×¢×¨×›×™ ××’×“×¨ ×œ×¤×•×¨××˜ ××—×™×“
- ×‘×“×™×§×ª ×§×™×•× ×œ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª

---

### ××ª×’×¨×™× ×•×¤×ª×¨×•× ×•×ª

#### ××ª×’×¨ 1: ×”×ª× ×’×©×•×ª ××–×”×™×
**×‘×¢×™×”:** ×©× ×™ ××¡×“×™ ×”× ×ª×•× ×™× ××©×ª××©×™× ×‘××•×ª× ××–×”×™×
**×¤×ª×¨×•×Ÿ:** ×”×¡×˜×” ×§×‘×•×¢×” ×©×œ 1000 ×œ××–×”×™ ×”××¢×¨×›×ª ×”×—×“×©×”

#### ××ª×’×¨ 2: ×¤×•×¨××˜×™× ×©×•× ×™× ×©×œ × ×ª×•× ×™×
**×‘×¢×™×”:** ×”××¢×¨×›×•×ª ××©×ª××©×•×ª ×‘×¤×•×¨××˜×™× ×©×•× ×™× (M/F vs Male/Female)
**×¤×ª×¨×•×Ÿ:** ×¤×•× ×§×¦×™×•×ª ×”××¨×” ×¢× CASE statements

#### ××ª×’×¨ 3: ×©×“×•×ª ×—×¡×¨×™×
**×‘×¢×™×”:** ×˜×‘×œ××•×ª ×“×•××•×ª ×¢× ×©×“×•×ª ×©×•× ×™×
**×¤×ª×¨×•×Ÿ:** ×”×•×¡×¤×ª ×©×“×•×ª ×—×¡×¨×™× ×¢× ×¢×¨×›×™ ×‘×¨×™×¨×ª ××—×“×œ ××• ×¢×¨×›×™× ××§×¨××™×™×

#### ××ª×’×¨ 4: ×™×—×¡×™× ××•×¨×›×‘×™×
**×‘×¢×™×”:** ××‘× ×™ ×™×—×¡×™× ×©×•× ×™× ×‘×™×Ÿ ×”××¢×¨×›×•×ª
**×¤×ª×¨×•×Ÿ:** ×™×¦×™×¨×ª ×˜×‘×œ××•×ª ×××¦×¢ ×•×”×ª×××ª ×”×§×©×¨×™×

#### ××ª×’×¨ 5: ×ª×œ×•×ª ×‘×–××Ÿ
**×‘×¢×™×”:** ×”××¢×¨×›×ª ×”××§×•×¨×™×ª ×œ× ××›×™×œ×” ××‘× ×” ×–×× ×™× ××•×‘× ×”
**×¤×ª×¨×•×Ÿ:** ×™×¦×™×¨×ª TimeSlot ×—×“×© ×•××™×¤×•×™ ××”×©×“×•×ª ×”×§×™×™××™×

---

### ××¡×§× ×•×ª

#### ×”×™×©×’×™× ×¢×™×§×¨×™×™×:
1. **××™× ×˜×’×¨×¦×™×” ××•×¦×œ×—×ª** ×©×œ ×©×ª×™ ××¢×¨×›×•×ª ××•×¨×›×‘×•×ª
2. **×©××™×¨×” ×¢×œ ×ª×§×™× ×•×ª ×”× ×ª×•× ×™×** ×œ××•×¨×š ×›×œ ×”×ª×”×œ×™×š
3. **×™×¦×™×¨×ª ××¢×¨×›×ª ×××•×—×“×ª** ×¢× ×™×›×•×œ×•×ª ××©×•×¤×¨×•×ª
4. **×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×ª××™××•×ª** ×‘×™×Ÿ ××¢×¨×›×•×ª ×©×•× ×•×ª

#### ×©×™×¤×•×¨×™× ×©×”×•×©×’×•:
- **× ×™×”×•×œ ×–×× ×™× ××©×•×¤×¨** ×¢× TimeSlot
- **××¢×¨×›×ª ××—×™×¨×™× ××¤×•×¨×˜×ª** ××”××¢×¨×›×ª ×”×—×“×©×”
- **× ×™×”×•×œ ×¦×™×•×“ ××ª×§×“×** ×¢× ×”×’×‘×œ×•×ª ×’×™×œ
- **×’××™×©×•×ª ×¨×™×©×•×** ×¢× ××¤×©×¨×•×™×•×ª ××’×•×•× ×•×ª


×”××¢×¨×›×ª ×”××©×•×œ×‘×ª ××¡×¤×§×ª ×›×¢×ª ×¤×ª×¨×•×Ÿ ××§×™×£ ×œ× ×™×”×•×œ ××›×•× ×™ ×›×•×©×¨ ×•×œ× ××›×•×Ÿ ××—×“, ×›×œ×•××¨ ×¢× ×™×›×•×œ×ª ×œ× ×”×œ ×—×•×’×™ ×¡×¤×•×¨×˜ ××• ×¢×•×“ ××›×•× ×™× ×‘××™×§×•××™× ×©×•× ×™×, ×ª×•×š ×©××™×¨×” ×¢×œ ×›×œ ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×”××§×•×¨×™×ª ×©×œ ×©×ª×™ ×”××¢×¨×›×•×ª.

---
### ××‘×˜×™×

ğŸ“œ [×¦×¤×™×™×” ×‘×§×•×“ ×”××‘×˜×™× ×•×”×©××™×œ×ª×•×ª ×”××œ×-`Views.sql`](Stage3)

#### ××‘×˜ #1: ××‘×˜ ×× ×§×•×“×ª ×”××§×•×¨ - ××›×•×Ÿ ×›×•×©×¨ ×™×—×™×“
##### ×©×: `single_gym_management_view`

##### ×ª×™××•×¨ ×”××‘×˜:
××‘×˜ ×–×” ××™×•×¢×“ ×œ× ×™×”×•×œ ××›×•×Ÿ ×›×•×©×¨ ×™×—×™×“ ×•××¡×¤×§ ××™×“×¢ ××§×™×£ ×¢×œ ×›×œ ×”×©×™×¢×•×¨×™× ×‘××›×•×Ÿ ××¡×•×™× (Studio ID = 130). ×”××‘×˜ ××©×œ×‘ ××™×“×¢ ×-7 ×˜×‘×œ××•×ª ×©×•× ×•×ª ×›×“×™ ×œ×”×¦×™×’ ×ª××•× ×” ×›×•×œ×œ×ª ×¢×œ ×¤×¢×™×œ×•×ª ×”××›×•×Ÿ, ×›×•×œ×œ ×¤×¨×˜×™ ×§×•×¨×¡×™×, ××“×¨×™×›×™×, ×–×× ×™ ×”×©×™×¢×•×¨×™×, ×—×“×¨×™× ×•××¡×¤×¨ ×”× ×¨×©××™×.

×”××‘×˜ ××—×‘×¨ ×‘×™×Ÿ ×”×˜×‘×œ××•×ª:
- Class (×©×™×¢×•×¨×™×)
- Course (×§×•×¨×¡×™×) 
- TimeSlot (×–×× ×™ ×©×™×¢×•×¨×™×)
- Person (×× ×©×™×)
- Trainer (××“×¨×™×›×™×)
- Room (×—×“×¨×™×)
- Studio (×¡×˜×•×“×™×•××™×)

##### ×”×¦×’×ª × ×ª×•× ×™× ××”××‘×˜:
```sql
SELECT * FROM single_gym_management_view LIMIT 10;
```

![×¦×™×œ×•× ××¡×š 2025-06-18 025038](https://github.com/user-attachments/assets/0d1865ee-0e79-45dc-a2c2-2a1db5f0988e)

---

#### ×©××™×œ×ª×•×ª ×¢×œ ×”××‘×˜ ×”×¨××©×•×Ÿ

##### ×©××™×œ×ª×” #1: ×“×•×— ×ª×¤×•×¡×ª ×—×“×¨×™× ×‘××›×•×Ÿ ×”×›×•×©×¨

##### ×ª×™××•×¨ ×”×©××™×œ×ª×”:
×©××™×œ×ª×” ×–×• ×× ×ª×—×ª ××ª × ×™×¦×•×œ ×”×—×“×¨×™× ×‘××›×•×Ÿ ×”×›×•×©×¨. ×”×™× ××¦×™×’×” ×¢×‘×•×¨ ×›×œ ×—×“×¨ ××ª ×”×§×™×‘×•×œ×ª ×©×œ×•, ××¡×¤×¨ ×”×©×™×¢×•×¨×™× ×”×›×•×œ×œ, ××¡×¤×¨ ×”× ×¨×©××™× ×”××§×¡×™××œ×™ ×•×”×××•×¦×¢, ×•××—×•×– ×”×ª×¤×•×¡×” ×”××§×¡×™××œ×™. ×”×ª×•×¦××•×ª ×××•×™× ×•×ª ×œ×¤×™ ××—×•×– ×”×ª×¤×•×¡×” ×”××§×¡×™××œ×™ ×‘×¡×“×¨ ×™×•×¨×“, ××” ×©×××¤×©×¨ ×œ×–×”×•×ª ××ª ×”×—×“×¨×™× ×”×¤×•×¤×•×œ×¨×™×™× ×‘×™×•×ª×¨ ×•××ª ××œ×• ×©×™×© ×‘×”× ××§×•× ×œ×©×™×¤×•×¨.

##### ×§×•×“ ×”×©××™×œ×ª×”:
```sql
SELECT 
    room_name,
    room_capacity,
    COUNT(course_id) AS total_classes,
    MAX(enrollment) AS max_enrollment,
    ROUND(AVG(enrollment)::numeric, 2) AS avg_enrollment,
    ROUND((MAX(enrollment) * 100.0 / room_capacity)::numeric, 2) AS max_capacity_percent
FROM 
    single_gym_management_view
GROUP BY 
    room_name, room_capacity
ORDER BY 
    max_capacity_percent DESC;
```

##### ×¤×œ×˜ ×”×©××™×œ×ª×”:

![×¦×™×œ×•× ××¡×š 2025-06-18 025228](https://github.com/user-attachments/assets/3dc8083b-5225-479f-8a93-b737eab7ae05)

---


##### ×©××™×œ×ª×” #2: ×“×•×— ×¢×œ ×”××“×¨×™×›×™× ×•×¨××ª ×”× ×™×¡×™×•×Ÿ ×‘××›×•×Ÿ

##### ×ª×™××•×¨ ×”×©××™×œ×ª×”:
×©××™×œ×ª×” ×–×• ××¡×¤×§×ª × ×™×ª×•×— ××§×™×£ ×©×œ ×”××“×¨×™×›×™× ×‘××›×•×Ÿ. ×”×™× ××¦×™×’×” ×¢×‘×•×¨ ×›×œ ××“×¨×™×š ××ª ×”×©×, ×”××™×Ÿ, ×¨××ª ×”× ×™×¡×™×•×Ÿ, ××¡×¤×¨ ×”×©×™×¢×•×¨×™× ×©×”×•× ××¢×‘×™×¨, ×¨×©×™××ª ×”×§×•×¨×¡×™× ×©×”×•× ××œ××“, ×•××¡×¤×¨ ×”×¡×˜×•×“× ×˜×™× ×”×›×•×œ×œ ×©×œ×•. ×”×ª×•×¦××•×ª ×××•×™× ×•×ª ×œ×¤×™ ××¡×¤×¨ ×”×©×™×¢×•×¨×™× ×•××¡×¤×¨ ×”×¡×˜×•×“× ×˜×™×, ××” ×©×××¤×©×¨ ×œ×–×”×•×ª ××ª ×”××“×¨×™×›×™× ×”×¤×¢×™×œ×™× ×‘×™×•×ª×¨ ×•×œ×”×¢×¨×™×š ××ª ×”×¢×•××¡ ×¢×œ ×›×œ ××“×¨×™×š.

##### ×§×•×“ ×”×©××™×œ×ª×”:
```sql
SELECT 
    trainer_name,
    trainer_gender,
    trainer_experience,
    COUNT(course_id) AS classes_taught,
    STRING_AGG(DISTINCT course_name, ', ') AS taught_courses,
    SUM(enrollment) AS total_students
FROM 
    single_gym_management_view
GROUP BY 
    trainer_name, trainer_gender, trainer_experience
ORDER BY 
    classes_taught DESC, total_students DESC;
```

##### ×¤×œ×˜ ×”×©××™×œ×ª×”:

![×¦×™×œ×•× ××¡×š 2025-06-18 025447](https://github.com/user-attachments/assets/5d43cc1e-2ffb-4ef4-a938-549c5318c3c9)

---

#### ××‘×˜ #2: ××‘×˜ ×× ×§×•×“×ª ×”×¨×©×ª - × ×™×”×•×œ ×¡×˜×•×“×™×•××™× ××¨×•×‘×™×
##### ×©×:`multi_studio_network_view`

##### ×ª×™××•×¨ ×”××‘×˜:
××‘×˜ ×–×” ××™×•×¢×“ ×œ× ×™×”×•×œ ×¨×©×ª ×©×œ ××›×•× ×™ ×›×•×©×¨ ××¨×•×‘×™× ×‘×¨×—×‘×™ ×”××¨×¥. ×”××‘×˜ ××¡×¤×§ ××™×“×¢ ××§×™×£ ×¢×œ ×›×œ ×”×¡×˜×•×“×™×•××™× ×‘×¨×©×ª, ×›×•×œ×œ ××™×§×•×, ×§×™×‘×•×œ×ª, ×§×•×¨×¡×™×, ××“×¨×™×›×™× ×•× ×ª×•× ×™ ×¨×™×©×•×.

×”××‘×˜ ××©×œ×‘ ××™×“×¢ ×-6 ×˜×‘×œ××•×ª:
- Room (×—×“×¨×™×)
- Studio (×¡×˜×•×“×™×•××™×)
- Class (×©×™×¢×•×¨×™×)
- Course (×§×•×¨×¡×™×)
- TimeSlot (×–×× ×™ ×©×™×¢×•×¨×™×)
- Person (×× ×©×™×)
- registers_for (×¨×™×©×•××™×)

##### ×”×¦×’×ª × ×ª×•× ×™× ××”××‘×˜:
```sql
SELECT * FROM multi_studio_network_view LIMIT 10;
```

![×¦×™×œ×•× ××¡×š 2025-06-18 030511](https://github.com/user-attachments/assets/81ec3c84-4213-4244-95bc-4ba2671aa461)

---

#### ×©××™×œ×ª×•×ª ×¢×œ ×”××‘×˜ ×”×©× ×™

##### ×©××™×œ×ª×” #1: ×”×©×•×•××ª ×‘×™×¦×•×¢×™× ×‘×™×Ÿ ×¡×˜×•×“×™×•××™× ×©×•× ×™×

##### ×ª×™××•×¨ ×”×©××™×œ×ª×”:
×©××™×œ×ª×” ×–×” ××‘×¦×¢×ª × ×™×ª×•×— ×”×©×•×•××ª×™ ××§×™×£ ×‘×™×Ÿ ×”×¡×˜×•×“×™×•××™× ×”×©×•× ×™× ×‘×¨×©×ª. ×”×™× ××¦×™×’×” ×¢×‘×•×¨ ×›×œ ×¡×˜×•×“×™×• ××“×“×™ ×‘×™×¦×•×¢×™× ××¨×›×–×™×™× ×›××• ××¡×¤×¨ ×”×§×•×¨×¡×™×, ×–×× ×™ ×”×©×™×¢×•×¨×™×, ××“×¨×™×›×™×, × ×¨×©××™×, ×’×•×“×œ ×©×™×¢×•×¨ ×××•×¦×¢ ×•××—×™×¨ ×××•×¦×¢. ×”×ª×•×¦××•×ª ×××•×™× ×•×ª ×œ×¤×™ ××¡×¤×¨ ×”× ×¨×©××™× ×”×›×•×œ×œ, ××” ×©×××¤×©×¨ ×œ×–×”×•×ª ××ª ×”×¡×˜×•×“×™×•××™× ×”××¦×œ×™×—×™× ×‘×™×•×ª×¨ ×•×œ×”×©×•×•×ª ×‘×™×¦×•×¢×™×.

##### ×§×•×“ ×”×©××™×œ×ª×”:
```sql
SELECT 
    studio_id,
    studio_location,
    studio_capacity,
    COUNT(DISTINCT course_id) AS total_courses_offered,
    COUNT(DISTINCT CONCAT(day, start_time)) AS total_timeslots,
    COUNT(DISTINCT trainer_id) AS total_trainers,
    SUM(enrollment) AS total_enrollment,
    ROUND(AVG(enrollment)::numeric, 2) AS avg_class_size,
    ROUND(AVG(course_price)::numeric, 2) AS avg_course_price
FROM 
    multi_studio_network_view
WHERE 
    course_id IS NOT NULL
GROUP BY 
    studio_id, studio_location, studio_capacity
ORDER BY 
    total_enrollment DESC;
```

##### ×¤×œ×˜ ×”×©××™×œ×ª×”:

![×¦×™×œ×•× ××¡×š 2025-06-18 030657](https://github.com/user-attachments/assets/44217cb6-27ad-4ed4-952f-5d29cb3176f8)


---

##### ×©××™×œ×ª×” #2: × ×™×ª×•×— ×–×× ×™ ×¤×¢×™×œ×•×ª ×¤×•×¤×•×œ×¨×™×™× ×‘×›×œ ×”×¡×˜×•×“×™×•××™×

##### ×ª×™××•×¨ ×”×©××™×œ×ª×”:
×©××™×œ×ª×” ×–×• ×× ×ª×—×ª ××ª ×“×¤×•×¡×™ ×”×¤×¢×™×œ×•×ª ×‘×›×œ ×”×¨×©×ª ×œ×¤×™ ×™××™× ×•×©×¢×•×ª. ×”×™× ××¦×™×’×” ×¢×‘×•×¨ ×›×œ ×–××Ÿ (×™×•× ×•×©×¢×”) ××ª ××¡×¤×¨ ×”×¡×˜×•×“×™×•××™× ×©××¦×™×¢×™× ×©×™×¢×•×¨×™×, ××¡×¤×¨ ×”×§×•×¨×¡×™× ×”×™×™×—×•×“×™×™×, ××¡×¤×¨ ×”× ×¨×©××™× ×”×›×•×œ×œ, ×××•×¦×¢ ×”× ×¨×©××™× ×•×××•×¦×¢ × ×™×¦×•×œ ×”×§×™×‘×•×œ×ª. ×”×ª×•×¦××•×ª ×××•×™× ×•×ª ×œ×¤×™ ××¡×¤×¨ ×”× ×¨×©××™× ×”×›×•×œ×œ, ××” ×©×××¤×©×¨ ×œ×–×”×•×ª ××ª ×–×× ×™ ×”×©×™× ×‘×¨×©×ª ×•×œ×ª×›× ×Ÿ ×‘×”×ª××.

##### ×§×•×“ ×”×©××™×œ×ª×”:
```sql
SELECT 
    day,
    start_time,
    COUNT(DISTINCT studio_id) AS studios_with_classes,
    COUNT(DISTINCT course_id) AS unique_courses,
    SUM(enrollment) AS total_enrollment,
    ROUND(AVG(enrollment)::numeric, 2) AS avg_enrollment,
    ROUND(AVG(capacity_utilization_percent)::numeric, 2) AS avg_capacity_utilization
FROM 
    multi_studio_network_view
WHERE 
    course_id IS NOT NULL
GROUP BY 
    day, start_time
ORDER BY 
    total_enrollment DESC, day, start_time;
```

##### ×¤×œ×˜ ×”×©××™×œ×ª×”:

![×¦×™×œ×•× ××¡×š 2025-06-18 030657](https://github.com/user-attachments/assets/acfeb27c-dd34-4a7d-8a4d-3ba11412140a)


---

#### ×œ×¡×™×›×•×

×”××‘×˜×™× ×©×¤×•×ª×—×• ××¡×¤×§×™× ×›×œ×™× × ×™×”×•×œ×™×™× ×—×©×•×‘×™×:

**×”××‘×˜ ×”×¨××©×•×Ÿ** ××ª××§×“ ×‘× ×™×”×•×œ ××›×•×Ÿ ×›×•×©×¨ ×™×—×™×“ ×•×××¤×©×¨ × ×™×ª×•×— ××¤×•×¨×˜ ×©×œ ×ª×¤×•×¡×ª ×—×“×¨×™× ×•×‘×™×¦×•×¢×™ ××“×¨×™×›×™×.

**×”××‘×˜ ×”×©× ×™** ××¡×¤×§ ×ª××•× ×” ×›×•×œ×œ×ª ×©×œ ×›×œ ×”×¨×©×ª ×•×××¤×©×¨ ×”×©×•×•××•×ª ×‘×™×Ÿ ×¡×˜×•×“×™×•××™× ×•× ×™×ª×•×— ××’××•×ª ×›×œ×œ×™×•×ª.

×”×©××™×œ×ª×•×ª ×¢×œ ×”××‘×˜×™× ××¡×¤×§×•×ª ××™×“×¢ ××¢×©×™ ×œ×§×‘×œ×ª ×”×—×œ×˜×•×ª × ×™×”×•×œ×™×•×ª, ×›××• ×–×™×”×•×™ ×¦×•×•××¨×™ ×‘×§×‘×•×§, ××•×¤×˜×™××™×–×¦×™×” ×©×œ ×œ×•×—×•×ª ×–×× ×™×, ×•× ×™×ª×•×— ×¨×•×•×—×™×•×ª.

### ×’×™×‘×•×™ ××¢×•×“×›×Ÿ

ğŸ“œ [×œ×”×•×¨×“×ª ×§×•×‘×¥ ×”×’×™×‘×•×™-`backup3`](Stage3)


# ×©×œ×‘ 4: ×ª×›× ×•×ª PL/pgSQL

### ×ª×§×¦×™×¨ ×”×©×œ×‘
×‘×©×œ×‘ ×–×” ×¤×™×ª×—× ×• ×ª×•×›× ×™×•×ª ××ª×§×“××•×ª ×‘-PL/pgSQL ×œ× ×™×”×•×œ ××›×•×Ÿ ×”×›×•×©×¨, ×”×›×•×œ×œ×•×ª ×¤×•× ×§×¦×™×•×ª, ×¤×¨×•×¦×“×•×¨×•×ª, ×˜×¨×™×’×¨×™× ×•×ª×•×›× ×™×•×ª ×¨××©×™×•×ª. ×”×ª×•×›× ×™×•×ª ××ª××—×•×ª ×‘× ×™×ª×•×— × ×ª×•× ×™ ×—×‘×¨×™×, × ×™×”×•×œ ×”×¨×©××•×ª ×œ×©×™×¢×•×¨×™×, × ×™×”×•×œ ×œ×•×— ×–×× ×™× ×©×œ ×××× ×™×, ×˜×™×¤×•×œ ×‘×¦×™×•×“ ×ª×§×•×œ ×•×‘×§×¨×ª ×§×™×‘×•×œ×ª ×©×™×¢×•×¨×™×.

---
## ×¤×•× ×§×¦×™×•×ª

### ğŸ“Š ×¤×•× ×§×¦×™×” 1: analyze_member_statistics - × ×™×ª×•×— ×¡×˜×˜×™×¡×˜×™×§×•×ª ×× ×•×™×

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`function1_MemberAnalytics.sql`](Stage4)

### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×¤×•× ×§×¦×™×” ××•×¨×›×‘×ª ×”×× ×ª×—×ª × ×ª×•× ×™ ×× ×•×™× ×•××—×–×™×¨×” ×¡×˜×˜×™×¡×˜×™×§×•×ª ××§×™×¤×•×ª ×›×•×œ×œ ×”×ª×¤×œ×’×•×ª ×’×™×œ××™×, ×¡×•×’ ×× ×•×™, ××¡×¤×¨ ×”×¨×©××•×ª ×œ×©×™×¢×•×¨×™× ×•××¦×‘ ×”×× ×•×™. ×”×¤×•× ×§×¦×™×” ××©×ª××©×ª ×‘-REF CURSOR ×œ×”×—×–×¨×ª ×ª×•×¦××•×ª ××•×‘× ×•×ª.

#### ××œ×× ×˜×™ ×ª×›× ×•×ª ×‘×©×™××•×©
- **Cursors**: Explicit cursors ×œ××¢×‘×¨ ×¢×œ × ×ª×•× ×™ ×—×‘×¨×™× ×•×©×™×¢×•×¨×™×
- **REF CURSOR**: ×”×—×–×¨×ª ×ª×•×¦××•×ª ××•×‘× ×•×ª
- **Records**: ×©×™××•×© ×‘×¨×©×•××•×ª ×œ××—×¡×•×Ÿ × ×ª×•× ×™×
- **DML Operations**: ×™×¦×™×¨×” ×•×¢×“×›×•×Ÿ ×©×œ ×˜×‘×œ×” ×–×× ×™×ª
- **Loops**: ×œ×•×œ××ª FOR ×œ××¢×‘×¨ ×¢×œ × ×ª×•× ×™×
- **Conditionals**: ×”×¡×ª×¢×¤×•×™×•×ª ××•×¨×›×‘×•×ª ×œ×¡×™×•×•×’ ×’×™×œ××™× ×•×¡×•×’×™ ×—×‘×¨×•×™×•×ª
- **Exception Handling**: ×˜×™×¤×•×œ ×‘×©×’×™××•×ª

#### ×”×§×•×“
```sql
CREATE OR REPLACE FUNCTION analyze_member_statistics(
    p_min_age INTEGER DEFAULT 18,
    p_membership_type VARCHAR DEFAULT NULL
) 
RETURNS REFCURSOR
LANGUAGE plpgsql
AS $$
DECLARE
    member_cursor CURSOR FOR 
        SELECT m.id, p.person_name, p.birth_date, m.membership_type,
               EXTRACT(YEAR FROM AGE(p.birth_date)) AS age,
               m.registrationdate, m.expirationdate
        FROM Member m
        JOIN Person p ON m.id = p.person_id
        WHERE EXTRACT(YEAR FROM AGE(p.birth_date)) >= p_min_age
        AND (p_membership_type IS NULL OR m.membership_type = p_membership_type);

    classes_cursor CURSOR(member_id INTEGER) FOR
        SELECT COUNT(*) as class_count
        FROM registers_for rf
        WHERE rf.person_id = member_id;

    member_rec RECORD;
    class_count_rec RECORD;
    v_total_members INTEGER := 0;
    v_active_members INTEGER := 0;
    v_expired_members INTEGER := 0;
    v_avg_age NUMERIC := 0;
    v_total_classes INTEGER := 0;
    v_result_cursor REFCURSOR := 'member_analytics_cursor';

BEGIN
    -- ×™×¦×™×¨×ª ×˜×‘×œ×” ×–×× ×™×ª ×œ×ª×•×¦××•×ª
    DROP TABLE IF EXISTS temp_member_analytics;
    CREATE TEMP TABLE temp_member_analytics (
        analysis_type VARCHAR(50),
        metric_name VARCHAR(100),
        metric_value NUMERIC,
        details TEXT
    );

    -- ×¢×™×‘×•×“ × ×ª×•× ×™ ×—×‘×¨×™×
    FOR member_rec IN member_cursor LOOP
        v_total_members := v_total_members + 1;

        -- ×‘×“×™×§×ª ××¦×‘ ×—×‘×¨×•×ª
        IF member_rec.expirationdate > CURRENT_DATE THEN
            v_active_members := v_active_members + 1;
        ELSE
            v_expired_members := v_expired_members + 1;
        END IF;

        -- ×¡×¤×™×¨×ª ×©×™×¢×•×¨×™× ×œ×—×‘×¨
        OPEN classes_cursor(member_rec.id);
        FETCH classes_cursor INTO class_count_rec;
        CLOSE classes_cursor;

        v_total_classes := v_total_classes + COALESCE(class_count_rec.class_count, 0);

        -- × ×™×ª×•×— ×§×‘×•×¦×•×ª ×’×™×œ
        IF member_rec.age BETWEEN 18 AND 25 THEN
            -- ×œ×•×’×™×§×ª ×¢×“×›×•×Ÿ/×”×•×¡×¤×” ×œ×˜×‘×œ×” ×–×× ×™×ª
        -- ... (×”××©×š ×”×§×•×“)
    END LOOP;

    RETURN v_result_cursor;
END;
$$;
```

---

### ğŸ“… ×¤×•× ×§×¦×™×” 2: get_trainer_schedule - ×œ×•×— ×–×× ×™× ×©×œ ××××Ÿ

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`function2_getTrainerSchedule.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×¤×•× ×§×¦×™×” ×”××—×–×™×¨×” ×œ×•×— ×–×× ×™× ××¤×•×¨×˜ ×©×œ ××××Ÿ ×¡×¤×¦×™×¤×™, ×›×•×œ×œ ×¤×¨×˜×™ ×”×©×™×¢×•×¨×™×, ×–×× ×™×, ×—×“×¨×™× ×•××¡×¤×¨ × ×¨×©××™×. ×”×¤×•× ×§×¦×™×” ×‘×•×“×§×ª ××ª ×§×™×•× ×”××××Ÿ ×•××—×–×™×¨×” REF CURSOR ×¢× ×”× ×ª×•× ×™× ××¡×•×“×¨×™× ×œ×¤×™ ×™××™× ×•×©×¢×•×ª.

#### ××œ×× ×˜×™ ×ª×›× ×•×ª ×‘×©×™××•×©
- **REF CURSOR**: ×”×—×–×¨×ª ×ª×•×¦××•×ª ××•×‘× ×•×ª
- **Records**: ××—×¡×•×Ÿ ×¤×¨×˜×™ ××××Ÿ
- **Exception Handling**: ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ××•×ª×××•×ª
- **Conditionals**: ×‘×“×™×§×ª ×§×™×•× ××××Ÿ
- **Complex Queries**: ×©××™×œ×ª×•×ª ××•×¨×›×‘×•×ª ×¢× JOINs

#### ×”×§×•×“
```sql
CREATE OR REPLACE FUNCTION get_trainer_schedule(trainer_id_param INTEGER)
RETURNS REFCURSOR
LANGUAGE plpgsql
AS $$
DECLARE
    schedule_cursor REFCURSOR := 'trainer_schedule_cursor';
    trainer_record RECORD;
    class_count INTEGER := 0;
BEGIN
    -- ×‘×“×™×§×ª ×§×™×•× ×”××××Ÿ
    SELECT p.person_name, t.experiencelevel 
    INTO trainer_record
    FROM person p 
    JOIN trainer t ON p.person_id = t.person_id 
    WHERE p.person_id = trainer_id_param;
    
    IF NOT FOUND THEN
        RAISE EXCEPTION 'Trainer with ID % not found', trainer_id_param;
    END IF;
    
    -- ×¤×ª×™×—×ª cursor ×¢× ×¤×¨×˜×™ ×”×©×™×¢×•×¨×™×
    OPEN schedule_cursor FOR
        SELECT 
            co.course_name,
            ts.day,
            ts.start_time,
            ts.end_time,
            r.room_name,
            c.registrants,
            CASE 
                WHEN c.registrants > 0 THEN 'Active'
                ELSE 'No Registrants'
            END as status
        FROM class c
        JOIN course co ON c.course_id = co.course_id
        JOIN timeslot ts ON c.timeslot_id = ts.timeslot_id
        JOIN room r ON c.room_id = r.room_id
        WHERE c.id = trainer_id_param
        ORDER BY 
            CASE ts.day
                WHEN 'Sunday' THEN 1
                WHEN 'Monday' THEN 2
                -- ... ×”××©×š ×¡×“×¨ ×”×™××™×
            END,
            ts.start_time;
    
    RETURN schedule_cursor;
END;
$$;
```


---
## ×¤×¨×•×¦×“×•×¨×•×ª

### ğŸ‘¥ ×¤×¨×•×¦×“×•×¨×” 1: register_member_to_class - ×¨×™×©×•× ×—×‘×¨ ×œ×©×™×¢×•×¨

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`procedure1_registerMemberToClass.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×¤×¨×•×¦×“×•×¨×” ××•×¨×›×‘×ª ×”×¨×•×©××ª ×—×‘×¨ ×œ×©×™×¢×•×¨ ×ª×•×š ×‘×“×™×§×ª ××’×‘×œ×•×ª ×’×™×œ, ×§×™×‘×•×œ×ª ×—×“×¨, ×—×‘×¨×•×ª ×‘×ª×•×§×£ ×•×× ×™×¢×ª ×¨×™×©×•× ×›×¤×•×œ. ×”×¤×¨×•×¦×“×•×¨×” ××—×¤×©×ª ×©×™×¢×•×¨ ××ª××™× ×•××‘×¦×¢×ª ××ª ×”×¨×™×©×•× ×‘××§×¨×” ×©×œ ×”×¦×œ×—×”.

#### ××œ×× ×˜×™ ×ª×›× ×•×ª ×‘×©×™××•×©
- **Loops**: ×œ×•×œ××ª FOR ×œ××¢×‘×¨ ×¢×œ ×©×™×¢×•×¨×™× ×–××™× ×™×
- **Records**: ××—×¡×•×Ÿ ×¤×¨×˜×™ ×©×™×¢×•×¨×™×
- **Conditionals**: ×‘×“×™×§×•×ª ××•×¨×›×‘×•×ª ×©×œ ×ª× ××™×
- **DML Operations**: INSERT ×•-UPDATE
- **Exception Handling**: ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ××•×ª×××•×ª
- **Boolean Variables**: ××©×ª× ×” ×œ×¢×§×™×‘ ×”×¦×œ×—×ª ×”×¨×™×©×•×

#### ×”×§×•×“
```sql
CREATE OR REPLACE PROCEDURE register_member_to_class(
    p_course_id INTEGER,
    p_member_id INTEGER
)
LANGUAGE plpgsql
AS $$
DECLARE
    class_rec RECORD;
    v_member_age INTEGER;
    v_registration_success BOOLEAN := FALSE;
BEGIN
    -- ×‘×“×™×§×ª ×§×™×•× ×”×§×•×¨×¡
    IF NOT EXISTS (SELECT 1 FROM Course WHERE course_id = p_course_id) THEN
        RAISE EXCEPTION 'Course ID % does not exist', p_course_id;
    END IF;

    -- ×‘×“×™×§×ª ×§×™×•× ×—×‘×¨ ×•×—×‘×¨×•×ª ×‘×ª×•×§×£
    SELECT EXTRACT(YEAR FROM AGE(p.birth_date)) INTO v_member_age
    FROM Person p
    JOIN Member m ON p.person_id = m.id
    WHERE m.id = p_member_id
    AND m.expirationdate > CURRENT_DATE;

    IF NOT FOUND THEN
        RAISE EXCEPTION 'Member % not found or membership expired', p_member_id;
    END IF;

    -- ×—×™×¤×•×© ×©×™×¢×•×¨ ××ª××™×
    FOR class_rec IN
        SELECT c.timeslot_id, c.idr as room_id, c.id as trainer_id, c.registrants,
               r.capacity as room_capacity, co.course_name, co.min_age,
               t.day, t.start_time
        FROM Class c
        JOIN Course co ON c.course_id = co.course_id
        JOIN TimeSlot t ON c.timeslot_id = t.timeslot_id
        JOIN Room r ON c.idr = r.room_id
        WHERE c.course_id = p_course_id
    LOOP
        -- ×‘×“×™×§×•×ª ×ª× ××™× ××¨×•×‘×•×ª
        IF v_member_age < class_rec.min_age OR
           COALESCE(class_rec.registrants, 0) >= class_rec.room_capacity OR
           EXISTS (SELECT 1 FROM registers_for WHERE person_id = p_member_id 
                  AND timeslot_id = class_rec.timeslot_id AND room_id = class_rec.room_id)
        THEN
            CONTINUE;
        END IF;

        -- ×‘×™×¦×•×¢ ×”×¨×™×©×•×
        INSERT INTO registers_for (person_id, timeslot_id, room_id)
        VALUES (p_member_id, class_rec.timeslot_id, class_rec.room_id);

        UPDATE Class
        SET registrants = COALESCE(registrants, 0) + 1
        WHERE timeslot_id = class_rec.timeslot_id AND idr = class_rec.room_id;

        v_registration_success := TRUE;
        EXIT;
    END LOOP;

    IF NOT v_registration_success THEN
        RAISE EXCEPTION 'No suitable class found for registration';
    END IF;
END;
$$;
```


---

### ğŸ”§ ×¤×¨×•×¦×“×•×¨×” 2: fix_broken_equipment - ×ª×™×§×•×Ÿ ×¦×™×•×“ ×ª×§×•×œ

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`â€â€procedure2_fixBrokenEquipment.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×¤×¨×•×¦×“×•×¨×” ×¤×©×•×˜×” ×•×™×¢×™×œ×” ×”×¡×•×¨×§×ª ××ª ×›×œ ×”×¦×™×•×“ ×”×ª×§×•×œ ×‘××›×•×Ÿ ×•××ª×§× ×ª ××•×ª×•. ×”×¤×¨×•×¦×“×•×¨×” ××©×ª××©×ª ×‘-Cursor ×œ××¢×‘×¨ ×¢×œ ×”×¦×™×•×“ ×”×ª×§×•×œ ×•××¢×“×›× ×ª ××ª ××¦×‘×• ×œ×ª×§×™×Ÿ.

#### ××œ×× ×˜×™ ×ª×›× ×•×ª ×‘×©×™××•×©
- **Explicit Cursor**: ×œ××¢×‘×¨ ×¢×œ ×¦×™×•×“ ×ª×§×•×œ
- **Records**: ××—×¡×•×Ÿ ×¤×¨×˜×™ ×¦×™×•×“
- **Loops**: ×œ×•×œ××ª FOR
- **DML Operations**: UPDATE
- **Counters**: ×¡×¤×™×¨×ª ×¤×¨×™×˜×™× ×©×ª×•×§× ×•
- **Exception Handling**: ×˜×™×¤×•×œ ×‘×©×’×™××•×ª

#### ×”×§×•×“
```sql
CREATE OR REPLACE PROCEDURE fix_broken_equipment()
LANGUAGE plpgsql
AS $$
DECLARE
    eq_cursor CURSOR FOR
        SELECT eq_id, eq_name, condition, age_restriction
        FROM equipment
        WHERE condition = 'F';

    eq_rec RECORD;
    fixed_count INTEGER := 0;
BEGIN
    RAISE NOTICE 'Starting broken equipment repair...';

    FOR eq_rec IN eq_cursor LOOP
        UPDATE equipment
        SET condition = 'T'
        WHERE eq_id = eq_rec.eq_id;

        fixed_count := fixed_count + 1;
        RAISE NOTICE 'Fixed equipment: % (ID: %)', eq_rec.eq_name, eq_rec.eq_id;
    END LOOP;

    IF fixed_count = 0 THEN
        RAISE NOTICE 'No broken equipment found.';
    ELSE
        RAISE NOTICE 'Total fixed equipment: %', fixed_count;
    END IF;
END;
$$;
```


---
## ×˜×¨×™×’×¨×™×

### âš¡ ×˜×¨×™×’×¨ 1: check_membership_expiration - ×”×ª×¨××” ×¢×œ ×¤×§×™×¢×ª ×× ×•×™

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`â€â€trigger1_membershipExpirationAlert.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×˜×¨×™×’×¨ ××ª×§×“× ×”×¤×•×¢×œ ×‘×¢×ª ×”×•×¡×¤×” ××• ×¢×“×›×•×Ÿ ×©×œ ×—×‘×¨×•×ª. ×”×˜×¨×™×’×¨ ×‘×•×“×§ ××ª ××¦×‘ ×”×—×‘×¨×•×ª, ×©×•×œ×— ×”×ª×¨××•×ª ×¢×œ ×¤×§×™×¢×” ××ª×§×¨×‘×ª ×•××‘×˜×œ ×”×¨×©××•×ª ××•×˜×•××˜×™×ª ×‘××§×¨×” ×©×œ ×× ×•×™ ×©×¤×’.

#### ××œ×× ×˜×™ ×ª×›× ×•×ª ×‘×©×™××•×©
- **Trigger Function**: ×¤×•× ×§×¦×™×™×ª ×˜×¨×™×’×¨
- **NEW/OLD Records**: ×’×™×©×” ×œ× ×ª×•× ×™× ×—×“×©×™× ×•×™×©× ×™×
- **Conditionals**: ×”×¡×ª×¢×¤×•×™×•×ª ××•×¨×›×‘×•×ª
- **DML Operations**: DELETE ××•×˜×•××˜×™
- **Date Calculations**: ×—×™×©×•×‘×™ ×ª××¨×™×›×™×
- **Exception Handling**: ×˜×™×¤×•×œ ×‘×©×’×™××•×ª

#### ×”×§×•×“
```sql
CREATE OR REPLACE FUNCTION check_membership_expiration()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
DECLARE
    person_name_var VARCHAR(30);
    days_until_expiry INTEGER;
    registrations_count INTEGER;
BEGIN
    -- ×§×‘×œ×ª ×©× ×”×—×‘×¨
    SELECT person_name INTO person_name_var
    FROM person
    WHERE person_id = NEW.person_id;
    
    -- ×—×™×©×•×‘ ×™××™× ×¢×“ ×¤×§×™×¢×”
    days_until_expiry := NEW.expirationdate - CURRENT_DATE;
    
    -- ×¡×¤×™×¨×ª ×”×¨×©××•×ª ×¤×¢×™×œ×•×ª
    SELECT COUNT(*) INTO registrations_count
    FROM registers_for
    WHERE person_id = NEW.person_id;
    
    -- ×”×¡×ª×¢×¤×•×ª ×œ×¤×™ ××¦×‘ ×”×—×‘×¨×•×ª
    IF NEW.expirationdate < CURRENT_DATE THEN
        -- ×—×‘×¨×•×ª ×¤×’×” - ×‘×™×˜×•×œ ×›×œ ×”×”×¨×©××•×ª
        DELETE FROM registers_for WHERE person_id = NEW.person_id;
        RAISE WARNING 'EXPIRED MEMBERSHIP: Member % (ID: %) membership has expired. All registrations cancelled.', 
                     person_name_var, NEW.person_id;
    ELSIF days_until_expiry <= 7 AND days_until_expiry > 0 THEN
        -- ×”×ª×¨××” ×¢×œ ×¤×§×™×¢×” ××ª×§×¨×‘×ª
        RAISE NOTICE 'EXPIRATION WARNING: Member % (ID: %) membership expires in % days.', 
                     person_name_var, NEW.person_id, days_until_expiry;
    END IF;
    
    RETURN NEW;
END;
$$;

CREATE OR REPLACE TRIGGER trigger_membership_expiration
    AFTER INSERT OR UPDATE OF expirationdate
    ON member
    FOR EACH ROW
    EXECUTE FUNCTION check_membership_expiration();
```

#### ×¦×™×œ× ×¤×¢×•×œ×”
** ×¦×™×œ×•× ×©×œ ×¢×“×›×•×Ÿ ×—×‘×¨×•×ª ×¢× ×”×•×“×¢×•×ª ×”×ª×¨××” ××”×˜×¨×™×’×¨**
![×¦×™×œ×•× ××¡×š 2025-06-23 004637](https://github.com/user-attachments/assets/b84c3411-57de-4b78-9bfc-96486a717158)



---

### ğŸ“Š ×˜×¨×™×’×¨ 2: validate_class_capacity - ×‘×§×¨×ª ×§×™×‘×•×œ×ª ×©×™×¢×•×¨×™×

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`â€â€trigger2_classCapacityValidation.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×˜×¨×™×’×¨ ××•×¨×›×‘ ×”×¤×•×¢×œ ×¢×œ ×˜×‘×œ×ª registers_for ×•×‘×•×“×§ ×§×™×‘×•×œ×ª ×©×™×¢×•×¨×™×. ×”×˜×¨×™×’×¨ ××•× ×¢ ×”×¨×©××•×ª ×—×•×¨×’×•×ª, ××¢×“×›×Ÿ ××•×˜×•××˜×™×ª ××ª ××¡×¤×¨ ×”× ×¨×©××™× ×•×©×•×œ×— ×”×ª×¨××•×ª ×›××©×¨ ×”×©×™×¢×•×¨ ××ª×§×¨×‘ ×œ×§×™×‘×•×œ×ª ××œ××”.

#### ××œ×× ×˜×™ ×ª×›× ×•×ª ×‘×©×™××•×©
- **Multi-Event Trigger**: ×˜×¨×™×’×¨ ×”×¤×•×¢×œ ×¢×œ INSERT/UPDATE/DELETE
- **TG_OP Variable**: ×–×™×”×•×™ ×¡×•×’ ×”×¤×¢×•×œ×”
- **Complex Conditionals**: ×‘×“×™×§×•×ª ××•×¨×›×‘×•×ª
- **DML Operations**: UPDATE ××•×˜×•××˜×™
- **Calculations**: ×—×™×©×•×‘ ××—×•×–×™ ×§×™×‘×•×œ×ª
- **Exception Handling**: ×–×¨×™×§×ª ×—×¨×™×’×•×ª ××•×ª×××•×ª

#### ×”×§×•×“
```sql
CREATE OR REPLACE FUNCTION validate_class_capacity()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
DECLARE
    room_capacity_var INTEGER;
    current_registrants_var INTEGER;
    course_name_var VARCHAR(50);
    room_name_var VARCHAR(15);
BEGIN
    -- ×§×‘×œ×ª ×¤×¨×˜×™ ×”×—×“×¨
    SELECT capacity, room_name INTO room_capacity_var, room_name_var
    FROM room
    WHERE room_id = COALESCE(NEW.room_id, OLD.room_id);
    
    IF TG_OP = 'INSERT' THEN
        -- ×‘×“×™×§×” ×‘×”×›× ×¡×ª ×”×¨×©××” ×—×“×©×”
        SELECT COUNT(*) INTO current_registrants_var
        FROM registers_for
        WHERE timeslot_id = NEW.timeslot_id AND room_id = NEW.room_id;
        
        -- ×‘×“×™×§×ª ×—×¨×™×’×” ××§×™×‘×•×œ×ª
        IF current_registrants_var > room_capacity_var THEN
            RAISE EXCEPTION 'Cannot register: Room % capacity exceeded. Capacity: %, Attempting: %', 
                           room_name_var, room_capacity_var, current_registrants_var;
        END IF;
        
        -- ×¢×“×›×•×Ÿ ××¡×¤×¨ ×”×¨×©×•××™×
        UPDATE class 
        SET registrants = current_registrants_var
        WHERE timeslot_id = NEW.timeslot_id AND idr = NEW.room_id;
        
        -- ×”×ª×¨××” ×× ××ª×§×¨×‘×™× ×œ×§×™×‘×•×œ×ª ××œ××”
        IF current_registrants_var >= (room_capacity_var * 0.9) THEN
            RAISE NOTICE 'CAPACITY WARNING: Class in room % is nearly full (%/% capacity)', 
                         room_name_var, current_registrants_var, room_capacity_var;
        END IF;
        
        RETURN NEW;
    -- ... (×˜×™×¤×•×œ ×‘-DELETE ×•-UPDATE)
    END IF;
END;
$$;
```

#### ×¦×™×œ×•× ×¤×¢×•×œ×”
**×¦×™×œ×•× ×©×œ ×”×¨×©××” ×œ×©×™×¢×•×¨ ×¢× ×”×•×“×¢×ª ××–×”×¨×” ×¢×œ ×§×™×‘×•×œ×ª ××• ×—×¨×™×’×” ××§×™×‘×•×œ×ª**
![×¦×™×œ×•× ××¡×š 2025-06-23 035319](https://github.com/user-attachments/assets/ea9dd711-5444-4e15-aea9-f6752f19e04f)

---
## ×ª×•×›× ×™×•×ª ×¨××©×™×•×ª

### ğŸš€ ×ª×•×›× ×™×ª ×¨××©×™×ª 1: program1 - × ×™×ª×•×— ×—×‘×¨×™× ×•×¨×™×©×•×

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`â€â€program1.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×ª×•×›× ×™×ª ××¨×›×–×™×ª ×”××‘×¦×¢×ª × ×™×ª×•×— ××§×™×£ ×©×œ × ×ª×•× ×™ ×—×‘×¨×™× ×•×œ××—×¨ ××›×Ÿ ×× ×¡×” ×œ×¨×©× ×—×‘×¨ ×œ×©×™×¢×•×¨. ×”×ª×•×›× ×™×ª ××¦×™×’×” ×“×•×’××” ×œ×©×™×œ×•×‘ ×¤×•× ×§×¦×™×” ×•×¤×¨×•×¦×“×•×¨×” ×‘×ª×•×š ×˜×¨× ×–×§×¦×™×”.

#### ×¨×›×™×‘×™ ×”×ª×•×›× ×™×ª
- **×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª × ×™×ª×•×—**: `analyze_member_statistics`
- **×§×¨×™××” ×œ×¤×¨×•×¦×“×•×¨×ª ×¨×™×©×•×**: `register_member_to_class`
- **× ×™×”×•×œ ×˜×¨× ×–×§×¦×™×•×ª**: BEGIN/ROLLBACK
- **×˜×™×¤×•×œ ×‘×—×¨×™×’×•×ª**: Exception handling

#### ×”×§×•×“
```sql
DO $$
DECLARE
    -- ×—×œ×§ ×”×× ×œ×™×˜×™×§×”
    v_cursor REFCURSOR;
    v_analysis_type TEXT;
    v_metric_name TEXT;
    v_metric_value NUMERIC;
    v_details TEXT;

    -- ×—×œ×§ ×”×¨×™×©×•×
    v_member_id INTEGER := 33;
    v_class_id INTEGER := 1010;
BEGIN
    RAISE NOTICE '--- Starting Member Analytics ---';
    
    -- ×¤×ª×™×—×ª ×”×§×•×¨×¡×•×¨ ×œ× ×™×ª×•×—
    v_cursor := analyze_member_statistics(18, NULL);

    -- ×œ×•×œ××” ×œ×§×¨×™××ª ×”×ª×•×¦××•×ª
    LOOP
        FETCH NEXT FROM v_cursor INTO v_analysis_type, v_metric_name, v_metric_value, v_details;
        EXIT WHEN NOT FOUND;
        RAISE NOTICE 'Analytics â†’ Type: %, Metric: %, Value: %', 
            v_analysis_type, v_metric_name, v_metric_value;
    END LOOP;

    -- ×¡×’×™×¨×ª ×”×§×•×¨×¡×•×¨
    CLOSE v_cursor;

    -- × ×™×¡×™×•×Ÿ ×œ×¨×©×•× ××ª ×”××©×ª××©
    RAISE NOTICE '--- Attempting Registration ---';
    BEGIN
        CALL register_member_to_class(v_member_id, v_class_id);
    EXCEPTION
        WHEN OTHERS THEN
            RAISE NOTICE 'Registration failed: %', SQLERRM;
    END;

END $$;
```

#### ×”×¨×¦×”
**×¦×™×œ×•× ×©×œ ×”×¨×¦×ª ×”×ª×•×›× ×™×ª ×”×¨××©×™×ª ×¢× ×ª×•×¦××•×ª ×”× ×™×ª×•×— ×•×”×¨×™×©×•×**

![×¦×™×œ×•× ××¡×š 2025-06-23 035319](https://github.com/user-attachments/assets/aefedc46-dccd-43f6-b343-b58fc9d21a10)

---

### ğŸ”§ ×ª×•×›× ×™×ª ×¨××©×™×ª 2: program2 - × ×™×”×•×œ ×¦×™×•×“ ×•×œ×•×— ×–×× ×™×

ğŸ“œ [×œ×¦×¤×™×™×” ×‘×§×•×“ ×”××œ×-`â€â€program2.sql`](Stage4)

#### ×ª×™××•×¨ ×”×ª×•×›× ×™×ª
×ª×•×›× ×™×ª ×©× ×™×™×” ×”××©×œ×‘×ª ×ª×™×§×•×Ÿ ×¦×™×•×“ ×ª×§×•×œ ×¢× ×”×¦×’×ª ×œ×•×— ×–×× ×™× ×©×œ ××××Ÿ. ××“×’×™××” ×©×™×œ×•×‘ ×©×œ ×¤×¨×•×¦×“×•×¨×” ×•×¤×•× ×§×¦×™×” ×‘×ª×•×š ×˜×¨× ×–×§×¦×™×” ××—×ª.

#### ×¨×›×™×‘×™ ×”×ª×•×›× ×™×ª
- **×§×¨×™××” ×œ×¤×¨×•×¦×“×•×¨×ª ×ª×™×§×•×Ÿ ×¦×™×•×“**: `fix_broken_equipment`
- **×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×œ×•×— ×–×× ×™×**: `get_trainer_schedule`
- **× ×™×”×•×œ ×˜×¨× ×–×§×¦×™×•×ª**: BEGIN/ROLLBACK

#### ×”×§×•×“
```sql
BEGIN;
DO $$
DECLARE
    v_trainer_id INTEGER := 402;
    v_cursor REFCURSOR;
    v_course_name TEXT;
    v_day TEXT;
    v_start TEXT;
    v_end TEXT;
    v_room TEXT;
    v_reg NUMERIC;
    v_status TEXT;
BEGIN
    -- ×—×œ×§ ×': ×ª×™×§×•×Ÿ ×¦×™×•×“ ×ª×§×•×œ
    CALL fix_broken_equipment();

    -- ×—×œ×§ ×‘': ×”×¦×’×ª ×œ×•×— ×–×× ×™× ×©×œ ××××Ÿ
    RAISE NOTICE 'Fetching schedule for trainer ID: %', v_trainer_id;
    v_cursor := get_trainer_schedule(v_trainer_id);

    LOOP
        FETCH NEXT FROM v_cursor INTO v_course_name, v_day, v_start, v_end, v_room, v_reg, v_status;
        EXIT WHEN NOT FOUND;
        RAISE NOTICE 'Class: %, Day: %, Time: %-% | Room: %, Registrants: %', 
                     v_course_name, v_day, v_start, v_end, v_room, v_reg;
    END LOOP;

    CLOSE v_cursor;
END $$;
ROLLBACK;
```

#### ×”×¨×¦×”
**×¦×™×œ×•× ×©×œ ×”×¨×¦×ª ×”×ª×•×›× ×™×ª ×”×©× ×™×™×” ×¢× ×ª×™×§×•×Ÿ ×¦×™×•×“ ×•×œ×•×— ×–×× ×™×**
![×¦×™×œ×•× ××¡×š 2025-06-23 130540](https://github.com/user-attachments/assets/43a08096-be3a-4863-9a66-26d303d71c6b)

---

### ğŸ“ ×©×™× ×•×™×™× ×‘×˜×‘×œ××•×ª - AlterTable.sql

#### ×ª×™××•×¨ ×”×©×™× ×•×™×™×
×‘×™×¦×¢× ×• ×¢×“×›×•×Ÿ ×‘×˜×‘×œ×ª Course ×œ×”×•×¡×¤×ª ××’×‘×œ×•×ª ×’×™×œ ×¨× ×“×•××œ×™×•×ª ×œ×§×•×¨×¡×™×, ×‘××˜×¨×” ×œ×”×¤×•×š ××ª ×‘×“×™×§×•×ª ×”×’×™×œ ×‘×¤×¨×•×¦×“×•×¨×ª ×”×¨×™×©×•× ×œ××¢× ×™×™× ×•×ª ×™×•×ª×¨.

#### ×”×§×•×“
```sql
UPDATE Course
SET min_age = FLOOR(RANDOM() * 7) + 16;
```

#### ×”×¡×‘×¨ ×”×©×™× ×•×™
×”×¢×“×›×•×Ÿ ××’×“×™×¨ ×œ×›×œ ×§×•×¨×¡ ×’×™×œ ××™× ×™××œ×™ ××§×¨××™ ×‘×™×Ÿ 16 ×œ-22, ××” ×©×××¤×©×¨ ×‘×“×™×§×” ×˜×•×‘×” ×™×•×ª×¨ ×©×œ ×œ×•×’×™×§×ª ×”×’×™×œ ×‘×¤×¨×•×¦×“×•×¨×ª ×”×¨×™×©×•×.

---

### ğŸ“Š ×¡×™×›×•× ××œ×× ×˜×™ ×”×ª×›× ×•×ª ×©×©×•×œ×‘×•

âœ… **Explicit Cursors** - ×‘×›×œ ×”×¤×•× ×§×¦×™×•×ª ×•×”×¤×¨×•×¦×“×•×¨×•×ª  
âœ… **REF Cursor** - ×‘×©×ª×™ ×”×¤×•× ×§×¦×™×•×ª  
âœ… **Records** - ×‘×›×œ ×”×ª×•×›× ×™×•×ª  
âœ… **DML Operations** - INSERT, UPDATE, DELETE ×‘××¡×¤×¨ ××§×•××•×ª  
âœ… **Loops** - ×œ×•×œ××•×ª FOR ×•-LOOP  
âœ… **Conditionals** - ×”×¡×ª×¢×¤×•×™×•×ª ××•×¨×›×‘×•×ª  
âœ… **Exception Handling** - ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×‘×›×œ ×”×ª×•×›× ×™×•×ª  
âœ… **Variables** - ××©×ª× ×™× ××¡×•×’×™× ×©×•× ×™×  
âœ… **Boolean Logic** - ××©×ª× ×™× ×‘×•×œ×™×× ×™×™× ×•×‘×“×™×§×•×ª ×ª× ××™  
âœ… **Date/Time Operations** - ×¢×‘×•×“×” ×¢× ×ª××¨×™×›×™×  
âœ… **Triggers** - ×©× ×™ ×˜×¨×™×’×¨×™× ××ª×§×“××™×  

---


---



